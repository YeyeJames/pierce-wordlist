<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pierce å°ˆç”¨æ‹¼å­—ç·´ç¿’ â€” é›¢ç·šæœ€çµ‚ç‰ˆ v5</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#121933; --accent:#7dd3fc; --accent2:#facc15; --good:#22c55e; --bad:#ef4444; --muted:#9aa4c7; --card:#0f172a;
    }
    html,body{margin:0;height:100%;background:var(--bg);color:#e5edff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans",sans-serif}
    *{box-sizing:border-box}
    .app{display:grid;grid-template-columns:1fr 360px;gap:16px;padding:96px 18px 24px;max-width:1280px;margin:0 auto}
    header.topbar{position:fixed;inset:0 0 auto 0;height:76px;background:rgba(17,24,39,.85);backdrop-filter:saturate(1.2) blur(8px);display:flex;align-items:center;gap:18px;padding:12px 18px;border-bottom:1px solid #263056;z-index:50}
    .brand{font-weight:800;letter-spacing:.3px}
    .statbar{display:flex;gap:18px;flex-wrap:wrap}
    .chip{display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--panel);border:1px solid #263056;border-radius:999px;font-weight:700}
    .coin{color:var(--accent2)}
    .btn{cursor:pointer;border:1px solid #2b375f;background:linear-gradient(180deg,#1b2550,#141c3c);padding:10px 14px;border-radius:12px;color:#e8edff;font-weight:800;transition:.2s;box-shadow:0 2px 0 #0b1128}
    .btn:hover{transform:translateY(-1px)}
    .btn:disabled{opacity:.5;cursor:not-allowed;filter:grayscale(.3)}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .card{background:var(--card);border:1px solid #243055;border-radius:16px;padding:16px;box-shadow:0 8px 30px rgba(0,0,0,.25)}
    .h{font-weight:900;font-size:20px;margin:0 0 8px}
    select, input[type=text]{background:#0a122b;border:1px solid #243055;color:#eaf0ff;border-radius:12px;padding:12px 14px;font-size:18px;outline:none}
    input[type=text]{width:100%}
    .answer-wrap{display:flex;gap:10px;align-items:center}
    .answer-wrap.cool input[type=text]{border:2px solid var(--accent);box-shadow:0 0 0 4px rgba(125,211,252,.15), inset 0 0 0 1px #243055}
    .pill{padding:6px 10px;border-radius:999px;background:#0a122b;border:1px solid #243055;color:#a8b3da;font-weight:700}
    .feedback{min-height:36px}
    .good{color:var(--good)} .bad{color:var(--bad)}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .store-item{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px;border:1px dashed #33406d;border-radius:12px}
    .store-item .price{color:var(--accent2);font-weight:800}
    .store-item .owned{color:var(--good);font-weight:800}
    .muted{color:var(--muted)}
    .kbr{font-weight:800;padding:2px 8px;border-radius:8px;border:1px solid #2a3560;background:#0a122b}
    .listbox{max-height:360px;overflow:auto;border:1px solid #22305b;border-radius:12px}
    .listbox details{border-bottom:1px solid #22305b}
    .listbox summary{padding:12px 14px;cursor:pointer;font-weight:800}
    .listbox .word{display:flex;justify-content:space-between;padding:10px 14px}
    .rules{white-space:pre-line}
    .earned{color:var(--accent2);font-weight:900}
    .tiny{font-size:12px}
    canvas#fx{position:fixed;inset:0;pointer-events:none;z-index:60}
  </style>
</head>
<body>
  <canvas id="fx"></canvas>
  <header class="topbar">
    <div class="brand">ğŸ Pierce Spelling Bee</div>
    <div class="statbar">
      <div class="chip"><span class="coin">ğŸª™</span> ç›®å‰é‡‘å¹£ï¼š<span id="coins">0</span></div>
      <div class="chip">é€£çºŒç­”å°ï¼š<span id="streak">0</span></div>
      <div class="chip">é‡‘å¹£ç²å–è¦å‰‡ <button class="btn" id="showRules">æŸ¥çœ‹</button></div>
    </div>
    <div style="margin-left:auto" class="row">
      <label class="muted">é€±æ¬¡ï¼š</label>
      <select id="weekSel"></select>
      <button id="newQ" class="btn">ä¸‹ä¸€é¡Œ</button>
      <button id="replay" class="btn" title="å†è½ä¸€æ¬¡ (T)">å†è½ä¸€æ¬¡ ğŸ”Š</button>
    </div>
  </header>

  <main class="app">
    <section class="card" id="play">
      <h2 class="h">ğŸ§ è½å¯«ç·´ç¿’</h2>
      <div class="row tiny muted">æç¤ºï¼šæŒ‰ <span class="kbr">Enter</span> é€å‡ºã€<span class="kbr">T</span> å†è½ä¸€æ¬¡</div>
      <div style="height:8px"></div>
      <div class="answer-wrap" id="answerWrap">
        <input id="answer" type="text" inputmode="latin" autocomplete="off" placeholder="è«‹è¼¸å…¥æ‹¼å­—â€¦" />
        <button id="submit" class="btn">é€å‡º</button>
      </div>
      <div class="feedback" id="feedback"></div>
      <div id="explain" class="muted"></div>
      <div id="sentence" class="muted tiny"></div>
      <div style="height:6px"></div>
      <div class="tiny muted">æœ¬é¡Œå·²æ’­æ”¾ï¼š<span id="playedOnce">0</span> æ¬¡</div>
      <div style="height:12px"></div>
      <div class="grid-2">
        <div class="card" style="background:#0c1430">
          <div class="h">ğŸ™ï¸ è‡ªå·±éŒ„æç¤º</div>
          <div class="row">
            <button id="recBtn" class="btn">éŒ„éŸ³</button>
            <button id="playRec" class="btn" disabled>æ’­æ”¾éŒ„éŸ³</button>
            <span id="recStatus" class="muted">ï¼ˆæ¯å€‹å–®å­—æœƒå„è‡ªå„²å­˜ï¼Œä¸‹æ¬¡ä¹Ÿèƒ½æ’­æ”¾ï¼‰</span>
          </div>
        </div>
        <div class="card" style="background:#0c1430">
          <div class="h">ğŸ›’ å°å•†åº—</div>
          <div class="store-item">
            <div>ç…™ç«ç‰¹æ•ˆ</div>
            <div class="row">
              <span class="price">30ğŸª™</span>
              <button data-item="fireworks" class="buy btn">è³¼è²·</button>
            </div>
          </div>
          <div class="store-item">
            <div>èªéŸ³åŒ…ï¼ˆè‡ªç„¶èªé€Ÿ + è¼•å¾®å›è²ï¼‰</div>
            <div class="row">
              <span class="price">20ğŸª™</span>
              <button data-item="voicepack" class="buy btn">è³¼è²·</button>
            </div>
          </div>
          <div class="store-item">
            <div>å¾ˆé…·çš„è¼¸å…¥æ¡†æ¨£å¼</div>
            <div class="row">
              <span class="price">15ğŸª™</span>
              <button data-item="coolinput" class="buy btn">è³¼è²·</button>
            </div>
          </div>
          <div class="store-item">
            <div>âœ¨ ä¸»é¡Œé¡è‰²åŒ…</div>
            <div class="row">
              <span class="price">25ğŸª™</span>
              <button data-item="theme" class="buy btn">è³¼è²·</button>
            </div>
          </div>
          <div class="store-item">
            <div>ğŸµ ç­”å°éŸ³æ•ˆåŒ…</div>
            <div class="row">
              <span class="price">20ğŸª™</span>
              <button data-item="sound" class="buy btn">è³¼è²·</button>
            </div>
          </div>
          <div class="store-item">
            <div>ğŸ“œ é¡¯ç¤ºä¾‹å¥åŠŸèƒ½</div>
            <div class="row">
              <span class="price">10ğŸª™</span>
              <button data-item="sentence" class="buy btn">è³¼è²·</button>
            </div>
          </div>
          <div class="store-item">
            <div>ğŸ§­ éš¨æ©Ÿæ¨¡å¼åˆ‡æ›</div>
            <div class="row">
              <span class="price">10ğŸª™</span>
              <button data-item="random" class="buy btn">è³¼è²·</button>
            </div>
          </div>
          <div class="tiny muted">å·²è³¼è²·é …ç›®æœƒæ°¸ä¹…ä¿ç•™åœ¨æ­¤è£ç½®ï¼ˆlocalStorageï¼‰ã€‚</div>
        </div>
      </div>
    </section>

    <aside class="card">
      <div class="row" style="justify-content:space-between">
        <h3 class="h">ğŸ“š å–®å­—æ¸…å–®</h3>
        <button id="toggleList" class="btn">é¡¯ç¤º/éš±è—</button>
      </div>
      <div id="wordList" class="listbox" hidden></div>
      <div style="height:12px"></div>
      <div class="card" style="background:#0c1430">
        <div class="h">ğŸ“ è¦å‰‡</div>
        <div class="rules tiny muted">
          1) æ–°é¡Œç›®è‡ªå‹•æ’­ç™¼éŸ³ä¸€æ¬¡ï¼ˆæ­¤æ™‚ä¸é¡¯ç¤ºä¸­æ–‡ï¼‰ã€‚\n2) ç­”å° +1 å¹£ï¼›é”åˆ°ä»¥ä¸‹é€£æ“Šæ™‚é¡å¤–åŠ æˆï¼š3é¡Œ +1ã€5é¡Œ +3ã€10é¡Œ +5ã€20é¡Œ +10ã€‚\n3) ç­”éŒ¯ä¸æ‰£åˆ†ï¼Œä¸¦ç«‹å³é¡¯ç¤ºä¸­æ–‡è§£é‡‹ã€‚\n4) å¯éŒ„éŸ³åšæç¤ºï¼Œæ¯å€‹å–®å­—ç¨ç«‹å„²å­˜ï¼Œä¸‹æ¬¡ä¹Ÿèƒ½æ’­æ”¾ã€‚
        </div>
      </div>
    </aside>
  </main>

  <dialog id="rulesDlg" class="card" style="max-width:680px">
    <h3 class="h">é‡‘å¹£ç²å–è¦å‰‡</h3>
    <div class="rules">
+ æ¯é¡Œç­”å° +1ã€‚\n+ é€£çºŒç­”å°é”é–€æª»æ™‚ï¼Œç•¶ä¸‹é‚£é¡Œé¡å¤–åŠ ï¼š\n  â€¢ 3é¡Œï¼š+1\n  â€¢ 5é¡Œï¼š+3\n  â€¢ 10é¡Œï¼š+5\n  â€¢ 20é¡Œï¼š+10
    </div>
    <div style="height:14px"></div>
    <button id="closeRules" class="btn">äº†è§£</button>
  </dialog>

  <script>
/** =============================
 *  ğŸ è³‡æ–™å€ â€” å–®å­—åº«ï¼ˆWeek 1~18ï¼‰
 *  çµæ§‹ï¼š[{en, zh}]
 *  ============================= */
const WORDS = {
  "Week 1": [
    {en:"bank", zh:"éŠ€è¡Œ"},{en:"camp", zh:"éœ²ç‡Ÿ"},{en:"hand", zh:"æ‰‹"},{en:"paint", zh:"æ²¹æ¼†"},{en:"plant", zh:"æ¤ç‰©"},{en:"pond", zh:"æ± å¡˜"},{en:"pump", zh:"å¹«æµ¦"},{en:"stamp", zh:"éƒµç¥¨"},{en:"stand", zh:"ç«™ç«‹"},{en:"stump", zh:"æ¨¹æ¨"},{en:"wind", zh:"é¢¨"},{en:"wink", zh:"çœ¨çœ¼"},{en:"hungry", zh:"é£¢é¤“çš„"},{en:"lapping", zh:"èˆ”ã€æ‹æ‰“ï¼ˆæ°´ï¼‰"},{en:"milk", zh:"ç‰›å¥¶"},{en:"quiet", zh:"å®‰éœçš„"},{en:"television", zh:"é›»è¦–"},{en:"backyard", zh:"å¾Œé™¢"},{en:"basement", zh:"åœ°ä¸‹å®¤"},{en:"clean", zh:"æ‰“æƒ"},{en:"fly up", zh:"é£›èµ·ä¾†"},{en:"keep-away", zh:"èº²é¿éŠæˆ²"},{en:"near", zh:"è¿‘çš„"},{en:"paint", zh:"æ²¹æ¼†"},{en:"upstairs", zh:"æ¨“ä¸Š"},
  ],
  "Week 2": [
    {en:"belt", zh:"çš®å¸¶"},{en:"elf", zh:"å°ç²¾éˆ"},{en:"gift", zh:"ç¦®ç‰©"},{en:"golf", zh:"é«˜çˆ¾å¤«"},{en:"left", zh:"å·¦é‚Š"},{en:"lift", zh:"æèµ·"},{en:"melt", zh:"èåŒ–"},{en:"quilt", zh:"æ£‰è¢«"},{en:"raft", zh:"æœ¨ç­"},{en:"shelf", zh:"æ¶å­"},{en:"wilt", zh:"æ¯è"},{en:"wolf", zh:"ç‹¼"},{en:"came", zh:"ä¾†äº†"},{en:"bait", zh:"é¤Œ"},{en:"rake", zh:"è€™å­"},{en:"hay", zh:"ä¹¾è‰"},{en:"plate", zh:"ç›¤å­"},{en:"pail", zh:"æ°´æ¡¶"},{en:"cane", zh:"æ‹æ–"},{en:"raise", zh:"èˆ‰èµ·"},{en:"grape", zh:"è‘¡è„"},{en:"say", zh:"èªª"},{en:"aid", zh:"å¹«åŠ©"},{en:"pain", zh:"ç–¼ç—›"},{en:"trail", zh:"å°å¾‘"},{en:"stain", zh:"æ±™æ¼¬"},{en:"blaze", zh:"ç«ç„°"},{en:"almost", zh:"å¹¾ä¹"},{en:"dishes", zh:"ç›¤å­"},{en:"everyone", zh:"æ¯å€‹äºº"},{en:"family", zh:"å®¶äºº"},{en:"later", zh:"ä¹‹å¾Œ"},{en:"soup", zh:"æ¹¯"},{en:"still", zh:"ä»ç„¶"},{en:"together", zh:"ä¸€èµ·"},{en:"window", zh:"çª—æˆ¶"},{en:"children", zh:"å­©å­å€‘"},{en:"collar", zh:"é ˜å­"},{en:"heel", zh:"è…³è·Ÿ"},{en:"hurt", zh:"å—å‚·"},{en:"in front of", zh:"åœ¨â€¦å‰é¢"},{en:"lean", zh:"å‚¾æ–œ"},{en:"pet store", zh:"å¯µç‰©åº—"},{en:"snort", zh:"å™´é¼»æ¯"},
  ],
  "Week 3": [
    {en:"scrape", zh:"åˆ®"},{en:"scratch", zh:"æŠ“"},{en:"screen", zh:"è¢å¹•"},{en:"scrub", zh:"ç”¨åŠ›æ“¦"},{en:"splash", zh:"æ¿ºèµ·"},{en:"split", zh:"åˆ†é–‹"},{en:"sprain", zh:"æ‰­å‚·"},{en:"spray", zh:"å™´ç‘"},{en:"spring", zh:"æ˜¥å¤© / å½ˆç°§"},{en:"strap", zh:"çš®å¸¶"},{en:"stripes", zh:"æ¢ç´‹"},{en:"strong", zh:"å¼·å£¯çš„"},{en:"deep", zh:"æ·±çš„"},{en:"meal", zh:"ä¸€é¤"},{en:"sheep", zh:"ç¾Š"},{en:"each", zh:"æ¯ä¸€å€‹"},{en:"wheel", zh:"è¼ªå­"},{en:"treat", zh:"æ‹›å¾…"},{en:"bean", zh:"è±†å­"},{en:"seen", zh:"çœ‹è¦‹ï¼ˆéå»åˆ†è©ï¼‰"},{en:"team", zh:"åœ˜éšŠ"},{en:"dream", zh:"å¤¢"},{en:"mean", zh:"æ„æ€æ˜¯"},{en:"leave", zh:"é›¢é–‹"},{en:"cream", zh:"å¥¶æ²¹"},{en:"sleep", zh:"ç¡è¦º"},{en:"sneeze", zh:"æ‰“å™´åš"},{en:"copies", zh:"å‰¯æœ¬"},{en:"enough", zh:"è¶³å¤ "},{en:"library", zh:"åœ–æ›¸é¤¨"},{en:"number", zh:"æ•¸å­—"},{en:"prizes", zh:"çå“"},{en:"ribbon", zh:"ç·å¸¶"},{en:"ring", zh:"æˆ’æŒ‡"},{en:"rope", zh:"ç¹©å­"},{en:"sign", zh:"æ¨™èªŒ"},{en:"tonight", zh:"ä»Šæ™š"},{en:"happen", zh:"ç™¼ç”Ÿ"},{en:"miss", zh:"æƒ³å¿µ"},{en:"nice", zh:"å¥½çš„"},{en:"steps", zh:"éšæ¢¯"},{en:"terrible", zh:"å¯æ€•çš„"},
  ],
  "Week 4": [
    {en:"knee", zh:"è†è“‹"},{en:"kneel", zh:"è·ªä¸‹"},{en:"knife", zh:"åˆ€"},{en:"knit", zh:"ç·¨ç¹”"},{en:"knob", zh:"åœ“å½¢æŠŠæ‰‹"},{en:"knock", zh:"æ•²"},{en:"knot", zh:"çµ"},{en:"wrap", zh:"åŒ…èµ·ä¾†"},{en:"wreath", zh:"èŠ±åœˆ"},{en:"wrench", zh:"æ‰³æ‰‹"},{en:"wrist", zh:"æ‰‹è…•"},{en:"write", zh:"å¯«"},{en:"wrong", zh:"éŒ¯çš„"},{en:"shy", zh:"å®³ç¾çš„"},{en:"right", zh:"æ­£ç¢ºçš„ / å³é‚Š"},{en:"wide", zh:"å¯¬çš„"},{en:"light", zh:"å…‰ / è¼•çš„"},{en:"pine", zh:"æ¾æ¨¹"},{en:"fight", zh:"æ‰“æ¶"},{en:"fly", zh:"é£›"},{en:"night", zh:"å¤œæ™š"},{en:"dry", zh:"ä¹¾çš„"},{en:"sight", zh:"è¦–ç·š"},{en:"might", zh:"å¯èƒ½"},{en:"tight", zh:"ç·Šçš„"},{en:"stripe", zh:"æ¢ç´‹"},{en:"sly", zh:"ç‹¡çŒ¾çš„"},{en:"cry", zh:"å“­"},{en:"basket", zh:"ç±ƒå­"},{en:"bend down", zh:"å½ä¸‹"},{en:"kind", zh:"è¦ªåˆ‡çš„ / ç¨®é¡"},{en:"wave", zh:"æ®æ‰‹ / æ³¢æµª"},{en:"enter", zh:"é€²å…¥"},{en:"never", zh:"å¾ä¸"},{en:"picture", zh:"åœ–ç‰‡"},{en:"proud", zh:"é©•å‚²çš„"},{en:"shiny", zh:"é–ƒäº®çš„"},{en:"spray", zh:"å™´ç‘"},
  ],
  "Week 5": [
    {en:"brick", zh:"ç£š"},{en:"check", zh:"æª¢æŸ¥"},{en:"chick", zh:"å°é›"},{en:"clock", zh:"æ™‚é˜"},{en:"duck", zh:"é´¨å­"},{en:"lock", zh:"é–"},{en:"pocket", zh:"å£è¢‹"},{en:"rack", zh:"æ¶å­"},{en:"rock", zh:"å²©çŸ³"},{en:"rocket", zh:"ç«ç®­"},{en:"snack", zh:"é»å¿ƒ"},{en:"thick", zh:"åšçš„"},{en:"track", zh:"è»Œé“"},{en:"poke", zh:"æˆ³"},{en:"boat", zh:"èˆ¹"},{en:"row", zh:"åˆ’èˆ¹"},{en:"goat", zh:"å±±ç¾Š"},{en:"snow", zh:"é›ª"},{en:"toad", zh:"èŸ¾èœ"},{en:"soap", zh:"è‚¥çš‚"},{en:"blow", zh:"å¹"},{en:"coat", zh:"å¤–å¥—"},{en:"tow", zh:"æ‹–æ‹‰"},{en:"coach", zh:"æ•™ç·´"},{en:"float", zh:"æ¼‚æµ®"},{en:"toast", zh:"åå¸"},{en:"slow", zh:"æ…¢çš„"},{en:"globe", zh:"åœ°çƒ"},{en:"at once", zh:"ç«‹åˆ»"},{en:"dog toys", zh:"ç‹—ç©å…·"},{en:"guess", zh:"çŒœ"},{en:"inside", zh:"è£¡é¢"},{en:"judge", zh:"è©•åˆ¤"},{en:"place", zh:"åœ°æ–¹"},
  ],
  "Week 6": [
    {en:"bright", zh:"æ˜äº®çš„"},{en:"caught", zh:"æŠ“åˆ°"},{en:"eight", zh:"å…«"},{en:"flight", zh:"é£›è¡Œ"},{en:"high", zh:"é«˜çš„"},{en:"knight", zh:"é¨å£«"},{en:"light", zh:"å…‰"},{en:"night", zh:"å¤œæ™š"},{en:"right", zh:"æ­£ç¢ºçš„"},{en:"sign", zh:"æ¨™èªŒ"},{en:"sight", zh:"è¦–åŠ›"},{en:"straight", zh:"ç›´çš„"},{en:"tight", zh:"ç·Šçš„"},{en:"tune", zh:"æ›²å­"},{en:"moon", zh:"æœˆäº®"},{en:"pool", zh:"æ¸¸æ³³æ± "},{en:"zoo", zh:"å‹•ç‰©åœ’"},{en:"rude", zh:"ç²—é­¯çš„"},{en:"soon", zh:"å¾ˆå¿«"},{en:"boot", zh:"é•·é´"},{en:"food", zh:"é£Ÿç‰©"},{en:"tube", zh:"ç®¡å­"},{en:"room", zh:"æˆ¿é–“"},{en:"moose", zh:"éº‹é¹¿"},{en:"goose", zh:"éµ"},{en:"zoom", zh:"å—–åœ°é£›"},{en:"balloon", zh:"æ°£çƒ"},{en:"shoot", zh:"å°„æ“Š"},{en:"a can of", zh:"ä¸€ç½"},{en:"enter", zh:"é€²å…¥"},{en:"first", zh:"ç¬¬ä¸€"},{en:"glitter", zh:"é–ƒå…‰"},{en:"gold", zh:"é‡‘å­"},{en:"prizes", zh:"çå“"},{en:"second", zh:"ç¬¬äºŒ"},{en:"sign up", zh:"å ±å"},{en:"surely", zh:"ç•¶ç„¶"},{en:"third", zh:"ç¬¬ä¸‰"},{en:"look at", zh:"çœ‹è‘—"},{en:"no cost", zh:"å…è²»"},{en:"nod", zh:"é»é ­"},{en:"paste", zh:"é»è²¼"},{en:"permission", zh:"è¨±å¯"},
  ],
  "Week 7": [
    {en:"basement", zh:"åœ°ä¸‹å®¤"},{en:"bright-eyed", zh:"çœ¼ç¥æ˜äº®çš„"},{en:"lean", zh:"å‚¾æ–œ"},{en:"past", zh:"éå»"},{en:"wrong", zh:"éŒ¯çš„"},{en:"remember", zh:"è¨˜å¾—"},{en:"clap", zh:"æ‹æ‰‹"},{en:"crowd", zh:"äººç¾¤"},{en:"hug", zh:"æ“æŠ±"},{en:"nervous", zh:"ç·Šå¼µçš„"},{en:"people", zh:"äººå€‘"},{en:"ring", zh:"æˆ’æŒ‡ / éˆ´è²"},
  ],
  "Week 8": [
    {en:"different", zh:"ä¸åŒçš„"},{en:"hold up", zh:"èˆ‰èµ·"},{en:"lay down", zh:"èººä¸‹"},{en:"other", zh:"å…¶ä»–çš„"},{en:"racehorse", zh:"è³½é¦¬"},{en:"win", zh:"è´"},{en:"winner", zh:"å‹åˆ©è€…"},
  ],
  "Week 9": [
    {en:"what", zh:"ä»€éº¼"},{en:"clash", zh:"è¡çª"},{en:"shock", zh:"éœ‡é©š"},{en:"while", zh:"ç•¶â€¦æ™‚"},{en:"shame", zh:"å¯æƒœ"},{en:"flash", zh:"é–ƒå…‰"},{en:"where", zh:"å“ªè£¡"},{en:"shine", zh:"ç™¼äº®"},{en:"why", zh:"ç‚ºä»€éº¼"},{en:"shore", zh:"æµ·å²¸"},{en:"shall", zh:"å°‡è¦"},{en:"share", zh:"åˆ†äº«"},{en:"shadow", zh:"å½±å­"},{en:"whisper", zh:"ä½èª"},{en:"whiskers", zh:"é¬é¬š"},{en:"different", zh:"ä¸åŒçš„"},{en:"hold up", zh:"èˆ‰èµ·"},{en:"lay down", zh:"èººä¸‹"},{en:"other", zh:"å…¶ä»–çš„"},{en:"racehorse", zh:"è³½é¦¬"},{en:"win", zh:"è´"},{en:"winner", zh:"å„ªå‹è€…"},{en:"braid", zh:"è¾®å­"},{en:"chain", zh:"éŠæ¢"},{en:"hay", zh:"ä¹¾è‰"},{en:"mail", zh:"éƒµä»¶"},{en:"pail", zh:"æ°´æ¡¶"},{en:"paint", zh:"æ²¹æ¼†"},{en:"pay", zh:"ä»˜éŒ¢"},{en:"rain", zh:"é›¨"},{en:"sail", zh:"å¸† / èˆªè¡Œ"},{en:"stain", zh:"æ±™æ¼¬"},{en:"train", zh:"ç«è»Š"},{en:"tray", zh:"æ‰˜ç›¤"},{en:"beads", zh:"ç å­"},{en:"bean", zh:"è±†å­"},{en:"beef", zh:"ç‰›è‚‰"},{en:"bread", zh:"éºµåŒ…"},{en:"head", zh:"é ­"},{en:"heel", zh:"è…³è·Ÿ"},{en:"leaf", zh:"è‘‰å­"},{en:"screen", zh:"è¢å¹•"},{en:"seat", zh:"åº§ä½"},{en:"steam", zh:"è’¸æ°£"},{en:"thread", zh:"ç·š"},{en:"tree", zh:"æ¨¹"},{en:"climb", zh:"çˆ¬"},{en:"myself", zh:"æˆ‘è‡ªå·±"},{en:"practice", zh:"ç·´ç¿’"},{en:"track", zh:"è»Œé“"},{en:"uncle", zh:"å”å”"},{en:"whiskers", zh:"é¬é¬š"},
  ],
  "Week 10": [
    {en:"braid", zh:"è¾®å­"},{en:"chain", zh:"éŠæ¢"},{en:"hay", zh:"ä¹¾è‰"},{en:"nail", zh:"æŒ‡ç”² / é‡˜å­"},{en:"pail", zh:"æ°´æ¡¶"},{en:"paint", zh:"æ²¹æ¼†"},{en:"pay", zh:"ä»˜éŒ¢"},{en:"rain", zh:"é›¨"},{en:"sail", zh:"èˆªè¡Œ"},{en:"stain", zh:"æ±™é»"},{en:"beads", zh:"ç å­"},{en:"bean", zh:"è±†å­"},{en:"beef", zh:"ç‰›è‚‰"},{en:"bead", zh:"ç å­"},{en:"head", zh:"é ­"},{en:"heel", zh:"è…³è·Ÿ"},{en:"leaf", zh:"è‘‰å­"},{en:"screen", zh:"è¢å¹•"},{en:"seat", zh:"åº§ä½"},{en:"steam", zh:"è’¸æ°£"},{en:"thread", zh:"ç·š"},{en:"tree", zh:"æ¨¹"},{en:"climb", zh:"çˆ¬"},{en:"myself", zh:"æˆ‘è‡ªå·±"},{en:"practice", zh:"ç·´ç¿’"},{en:"track", zh:"è»Œé“"},{en:"uncle", zh:"å”å”"},{en:"whiskers", zh:"é¬é¬š"},{en:"wrote", zh:"å¯«äº†"},{en:"clover", zh:"é…¢æ¼¿è‰"},{en:"danger", zh:"å±éšª"},{en:"field", zh:"ç”°é‡"},{en:"noise", zh:"å™ªéŸ³"},{en:"pass", zh:"ç¶“é"},{en:"rest", zh:"ä¼‘æ¯"},{en:"rumble", zh:"éš†éš†è²"},{en:"sky", zh:"å¤©ç©º"},{en:"thunder", zh:"é›·"},
  ],
  "Week 11": [
    {en:"blow", zh:"å¹"},{en:"bowl", zh:"ç¢—"},{en:"crow", zh:"çƒé´‰"},{en:"goat", zh:"å±±ç¾Š"},{en:"pillow", zh:"æ•é ­"},{en:"road", zh:"é“è·¯"},{en:"snow", zh:"é›ª"},{en:"soap", zh:"è‚¥çš‚"},{en:"throw", zh:"ä¸Ÿ"},{en:"toad", zh:"èŸ¾èœ"},{en:"toast", zh:"åå¸"},{en:"window", zh:"çª—æˆ¶"},{en:"bath", zh:"æ´—æ¾¡"},{en:"peach", zh:"æ¡ƒå­"},{en:"tooth", zh:"ç‰™é½’"},{en:"thin", zh:"ç˜¦çš„"},{en:"choke", zh:"å™åˆ°"},{en:"much", zh:"å¾ˆå¤š"},{en:"with", zh:"å’Œ"},{en:"chick", zh:"å°é›"},{en:"teach", zh:"æ•™"},{en:"thank", zh:"æ„Ÿè¬"},{en:"child", zh:"å°å­©"},{en:"chore", zh:"å®¶äº‹"},{en:"reach", zh:"åˆ°é”"},{en:"thick", zh:"åšçš„"},{en:"think", zh:"æ€è€ƒ"},{en:"carrot", zh:"èƒ¡è˜¿è””"},{en:"cool", zh:"æ¶¼çš„"},{en:"gloves", zh:"æ‰‹å¥—"},{en:"haircut", zh:"ç†é«®"},{en:"patch", zh:"è£œä¸"},{en:"pond", zh:"æ± å¡˜"},{en:"spring", zh:"æ˜¥å¤©"},{en:"voice", zh:"è²éŸ³"},{en:"wool", zh:"ç¾Šæ¯›"},{en:"acorn", zh:"æ©¡å­"},{en:"angry", zh:"ç”Ÿæ°£çš„"},{en:"as fast as", zh:"ç›¡å¯èƒ½å¿«"},{en:"bless", zh:"ç¥ç¦"},{en:"chattering", zh:"å–‹å–‹ä¸ä¼‘"},{en:"dig", zh:"æŒ–"},{en:"hill", zh:"å°å±±"},{en:"oak", zh:"æ©¡æ¨¹"},{en:"squirrel", zh:"æ¾é¼ "},{en:"thief", zh:"å°å·"},{en:"tiny", zh:"å¾ˆå°çš„"},
  ],
  "Week 12": [
    {en:"boot", zh:"é•·é´"},{en:"cook", zh:"ç…®"},{en:"hood", zh:"å¸½å…œ"},{en:"hook", zh:"é‰¤å­"},{en:"hoop", zh:"åœˆ"},{en:"moose", zh:"éº‹é¹¿"},{en:"pool", zh:"æ¸¸æ³³æ± "},{en:"school", zh:"å­¸æ ¡"},{en:"shook", zh:"æ–å‹•ï¼ˆéå»å¼ï¼‰"},{en:"spoon", zh:"æ¹¯åŒ™"},{en:"stood", zh:"ç«™ç«‹ï¼ˆéå»å¼ï¼‰"},{en:"stool", zh:"å‡³å­"},{en:"cause", zh:"åŸå› "},{en:"claw", zh:"çˆª"},{en:"crawl", zh:"çˆ¬è¡Œ"},{en:"draw", zh:"ç•«"},{en:"faucet", zh:"æ°´é¾é ­"},{en:"fawn", zh:"å°é¹¿"},{en:"laundry", zh:"æ´—è¡£"},{en:"paw", zh:"çˆªå­"},{en:"sauce", zh:"é†¬æ±"},{en:"shawl", zh:"æŠ«å·¾"},{en:"straw", zh:"å¸ç®¡ / ç¨»è‰"},{en:"yawn", zh:"æ‰“å“ˆæ¬ "},{en:"behind", zh:"åœ¨å¾Œé¢"},{en:"berry", zh:"æ¼¿æœ"},{en:"branches", zh:"æ¨¹æ"},{en:"bushy tail", zh:"æ¯›èŒ¸èŒ¸çš„å°¾å·´"},{en:"dance", zh:"è·³èˆ"},{en:"flag", zh:"æ——å­"},{en:"insect", zh:"æ˜†èŸ²"},{en:"quick", zh:"å¿«çš„"},{en:"skunk", zh:"è‡­é¼¬"},{en:"suddenly", zh:"çªç„¶åœ°"},
  ],
  "Week 13": [
    {en:"blew", zh:"å¹äº†"},{en:"chew", zh:"å’€åš¼"},{en:"dew", zh:"éœ²æ°´"},{en:"few", zh:"å°‘æ•¸"},{en:"flew", zh:"é£›äº†"},{en:"grew", zh:"æˆé•·"},{en:"jewelry", zh:"ç å¯¶"},{en:"mew", zh:"è²“å«"},{en:"new", zh:"æ–°çš„"},{en:"screw", zh:"èºçµ²"},{en:"stew", zh:"ç‡‰èœ"},{en:"threw", zh:"ä¸Ÿäº†"},{en:"art", zh:"è—è¡“"},{en:"yard", zh:"é™¢å­"},{en:"barn", zh:"ç©€å€‰"},{en:"park", zh:"å…¬åœ’"},{en:"hard", zh:"å›°é›£çš„"},{en:"cart", zh:"æ‰‹æ¨è»Š"},{en:"dark", zh:"é»‘æš—"},{en:"farm", zh:"è¾²å ´"},{en:"shark", zh:"é¯Šé­š"},{en:"sharp", zh:"éŠ³åˆ©çš„"},{en:"harm", zh:"å‚·å®³"},{en:"alarm", zh:"é¬§é˜"},{en:"arms", zh:"æ‰‹è‡‚"},{en:"march", zh:"ä¸‰æœˆ / è¡Œé€²"},{en:"smart", zh:"è°æ˜çš„"},{en:"buzzing", zh:"å—¡å—¡è²"},{en:"careful", zh:"å°å¿ƒçš„"},{en:"fur", zh:"æ¯›"},{en:"hit", zh:"æ‰“"},{en:"hole", zh:"æ´"},{en:"honey", zh:"èœ‚èœœ"},{en:"lick", zh:"èˆ”"},{en:"path", zh:"å°è·¯"},{en:"sting", zh:"è«"},{en:"stuck", zh:"å¡ä½çš„"},{en:"against", zh:"åå°"},{en:"hardly", zh:"å¹¾ä¹ä¸"},{en:"meadow", zh:"è‰åœ°"},{en:"middle", zh:"ä¸­é–“"},{en:"pit-pat", zh:"å™ å™ è²"},{en:"space", zh:"ç©ºé–“"},{en:"toss", zh:"ä¸Ÿ"},{en:"touch", zh:"è§¸ç¢°"},{en:"whistle", zh:"å£å“¨"},
  ],
  "Week 15": [
    {en:"baby", zh:"å¬°å…’"},{en:"bunny", zh:"å°å…”å­"},{en:"city", zh:"åŸå¸‚"},{en:"cry", zh:"å“­"},{en:"dry", zh:"ä¹¾çš„"},{en:"fly", zh:"é£›"},{en:"fry", zh:"ç‚¸"},{en:"happy", zh:"å¿«æ¨‚çš„"},{en:"party", zh:"æ´¾å°"},{en:"pony", zh:"å°é¦¬"},{en:"silly", zh:"å‚»çš„"},{en:"sky", zh:"å¤©ç©º"},{en:"story", zh:"æ•…äº‹"},{en:"chain", zh:"éˆå­"},{en:"chop", zh:"åˆ‡"},{en:"shed", zh:"æ£šå­"},{en:"shelf", zh:"æ¶å­"},{en:"thick", zh:"åšçš„"},{en:"thin", zh:"ç˜¦çš„"},{en:"think", zh:"æ€è€ƒ"},{en:"thread", zh:"ç·š"},{en:"three", zh:"ä¸‰"},{en:"throat", zh:"å–‰åš¨"},{en:"whale", zh:"é¯¨é­š"},{en:"wheel", zh:"è¼ªå­"},{en:"shines", zh:"ç™¼å…‰"},{en:"through", zh:"ç©¿é"},{en:"bouncing", zh:"å½ˆè·³çš„"},{en:"spider", zh:"èœ˜è››"},{en:"webs", zh:"ç¶²"},{en:"woods", zh:"æ¨¹æ—"},{en:"glass", zh:"ç»ç’ƒ"},{en:"tied together", zh:"ç¶åœ¨ä¸€èµ·"},{en:"drop", zh:"æ‰ä¸‹"},{en:"straight", zh:"ç›´çš„"},{en:"friendly", zh:"å‹å–„çš„"},{en:"bless", zh:"ç¥ç¦"},{en:"blink", zh:"çœ¨çœ¼"},{en:"crawl", zh:"çˆ¬"},{en:"flat", zh:"å¹³çš„"},{en:"follow", zh:"è·Ÿéš¨"},{en:"join", zh:"åŠ å…¥"},{en:"rock", zh:"å²©çŸ³"},{en:"star", zh:"æ˜Ÿæ˜Ÿ"},{en:"swish", zh:"å”°åœ°ä¸€è²"},
  ],
  "Week 16": [
    {en:"bath", zh:"æ´—æ¾¡"},{en:"bench", zh:"é•·å‡³"},{en:"branch", zh:"æ¨¹æ"},{en:"brush", zh:"åˆ·å­"},{en:"dish", zh:"ç›¤å­"},{en:"ditch", zh:"æºæ¸ "},{en:"path", zh:"å°å¾‘"},{en:"ring", zh:"æˆ’æŒ‡"},{en:"swing", zh:"ç›ªé¦éŸ†"},{en:"switch", zh:"é–‹é—œ"},{en:"teeth", zh:"ç‰™é½’"},{en:"watch", zh:"æ‰‹éŒ¶"},{en:"bird", zh:"é³¥"},{en:"more", zh:"æ›´å¤š"},{en:"shirt", zh:"è¥¯è¡«"},{en:"horse", zh:"é¦¬"},{en:"first", zh:"ç¬¬ä¸€"},{en:"for", zh:"ç‚ºäº†"},{en:"girl", zh:"å¥³å­©"},{en:"horn", zh:"è§’"},{en:"dirt", zh:"æ³¥åœŸ"},{en:"short", zh:"çŸ­çš„"},{en:"store", zh:"å•†åº—"},{en:"morning", zh:"æ—©æ™¨"},{en:"dinosaur", zh:"æé¾"},{en:"third", zh:"ç¬¬ä¸‰"},{en:"whirl", zh:"æ—‹è½‰"},{en:"appear", zh:"å‡ºç¾"},{en:"decide", zh:"æ±ºå®š"},{en:"furry", zh:"æ¯›èŒ¸èŒ¸çš„"},{en:"sister", zh:"å§å¦¹"},{en:"strange", zh:"å¥‡æ€ªçš„"},{en:"tease", zh:"å–ç¬‘"},
  ],
  "Week 17": [
    {en:"barn", zh:"ç©€å€‰"},{en:"card", zh:"å¡ç‰‡"},{en:"dart", zh:"é£›é¢"},{en:"fern", zh:"è•¨é¡"},{en:"harp", zh:"è±ç´"},{en:"ladder", zh:"æ¢¯å­"},{en:"letter", zh:"ä¿¡"},{en:"number", zh:"æ•¸å­—"},{en:"paper", zh:"ç´™"},{en:"shark", zh:"é¯Šé­š"},{en:"slipper", zh:"æ‹–é‹"},{en:"water", zh:"æ°´"},{en:"yard", zh:"é™¢å­"},{en:"flutter", zh:"æ‹å‹•"},{en:"flyer", zh:"å‚³å–®"},{en:"minute", zh:"åˆ†é˜"},{en:"nearby", zh:"é™„è¿‘"},{en:"reach", zh:"åˆ°é”"},{en:"seem", zh:"ä¼¼ä¹"},{en:"throat", zh:"å–‰åš¨"},{en:"hummingbird", zh:"èœ‚é³¥"},{en:"afraid", zh:"å®³æ€•"},{en:"exclaimed", zh:"é©šå‘¼"},{en:"frightened", zh:"å®³æ€•çš„"},{en:"lift", zh:"æŠ¬èµ·"},{en:"shut", zh:"é—œä¸Š"},{en:"stretch", zh:"ä¼¸å±•"},{en:"wide", zh:"å¯¬çš„"},
  ],
  "Week 18": [
    {en:"cork", zh:"è»Ÿæœ¨å¡"},{en:"corn", zh:"ç‰ç±³"},{en:"dirt", zh:"æ³¥åœŸ"},{en:"fork", zh:"å‰å­"},{en:"horn", zh:"è§’"},{en:"shirt", zh:"è¥¯è¡«"},{en:"short", zh:"çŸ­çš„"},{en:"skirt", zh:"è£™å­"},{en:"squirt", zh:"å™´å‡º"},{en:"stir", zh:"æ”ªæ‹Œ"},{en:"storm", zh:"æš´é¢¨é›¨"},{en:"third", zh:"ç¬¬ä¸‰"},{en:"thorn", zh:"èŠæ£˜"},{en:"burn", zh:"ç‡’"},{en:"curb", zh:"è·¯é‚Š"},{en:"curl", zh:"æ²æ›²"},{en:"fur", zh:"æ¯›"},{en:"hurt", zh:"å—å‚·"},{en:"turn", zh:"è½‰å½"},{en:"does", zh:"åšï¼ˆç¬¬ä¸‰äººç¨±ï¼‰"},{en:"were", zh:"æ˜¯ï¼ˆéå»å¼ï¼‰"},{en:"every", zh:"æ¯å€‹"},{en:"very", zh:"éå¸¸"},{en:"give", zh:"çµ¦"},{en:"live", zh:"ç”Ÿæ´»"},{en:"thing", zh:"æ±è¥¿"},{en:"your", zh:"ä½ çš„"},{en:"many", zh:"è¨±å¤š"},{en:"who", zh:"èª°"},{en:"any", zh:"ä»»ä½•"},{en:"away", zh:"é›¢é–‹"},{en:"goes", zh:"å»ï¼ˆç¬¬ä¸‰äººç¨±ï¼‰"},{en:"find", zh:"æ‰¾åˆ°"},{en:"kind", zh:"ç¨®é¡ / å¥½çš„"},{en:"ago", zh:"ä»¥å‰"},{en:"another", zh:"å¦ä¸€å€‹"},{en:"corner", zh:"è§’è½"},{en:"everywhere", zh:"åˆ°è™•"},{en:"fold", zh:"æ‘º"},{en:"important", zh:"é‡è¦çš„"},{en:"mouse", zh:"è€é¼ "},{en:"neck", zh:"è„–å­"},{en:"owl", zh:"è²“é ­é·¹"},{en:"sharp", zh:"éŠ³åˆ©çš„"},{en:"size", zh:"å°ºå¯¸"},{en:"supper", zh:"æ™šé¤"},{en:"argue", zh:"çˆ­åµ"},{en:"bright", zh:"æ˜äº®çš„"},{en:"button", zh:"éˆ•æ‰£"},{en:"chuckle", zh:"è¼•ç¬‘"},{en:"ladybug", zh:"ç“¢èŸ²"},{en:"prettiest", zh:"æœ€æ¼‚äº®çš„"},{en:"shout", zh:"å«å–Š"},{en:"spots", zh:"æ–‘é»"},{en:"whole", zh:"æ•´å€‹çš„"},
  ],
};

/** =============================
 *  âš™ï¸ ç‹€æ…‹èˆ‡æŒä¹…åŒ–
 *  ============================= */
const $ = s=>document.querySelector(s);
const coinsEl = $("#coins"), streakEl = $("#streak"), playedEl = $("#playedOnce");
const feedback = $("#feedback"), explain = $("#explain"), sentenceEl=$("#sentence");
const answer = $("#answer"), submitBtn = $("#submit"), replayBtn=$("#replay"), newQBtn=$("#newQ");
const weekSel = $("#weekSel"), wordList = $("#wordList"), toggleListBtn=$("#toggleList");
const answerWrap = $("#answerWrap");
let state = {
  coins: 0,
  streak: 0,
  purchased: { fireworks:false, voicepack:false, coolinput:false, theme:false, sound:false, sentence:false, random:false },
  currentWeek: Object.keys(WORDS)[0],
  qIndex: -1,
  order: [],
  played: 0,
  currentWord: null,
};
// è®€å– localStorage
try{
  const raw = localStorage.getItem("pierce_spellingbee_v5");
  if(raw){ state = {...state, ...JSON.parse(raw)}; }
}catch(e){ console.warn(e); }
updateHeader();

function save(){ localStorage.setItem("pierce_spellingbee_v5", JSON.stringify(state)); }

/** =============================
 *  ğŸ”Š TTS èªéŸ³
 *  ============================= */
function speak(text){
  if(!window.speechSynthesis) return;
  const u = new SpeechSynthesisUtterance(text);
  if(state.purchased.voicepack){ u.rate = 0.95; u.pitch = 1.02; u.volume = 1; }
  u.lang = 'en-US';
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

/** ğŸµ ç­”å°éŸ³æ•ˆï¼ˆWebAudio ç°¡å–®æç¤ºï¼‰ */
let ac; function beep(){ if(!state.purchased.sound) return; ac = ac || new (window.AudioContext||window.webkitAudioContext)(); const o=ac.createOscillator(); const g=ac.createGain(); o.type='triangle'; o.frequency.value=880; g.gain.setValueAtTime(0.001, ac.currentTime); g.gain.exponentialRampToValueAtTime(0.2, ac.currentTime+0.01); g.gain.exponentialRampToValueAtTime(0.001, ac.currentTime+0.2); o.connect(g).connect(ac.destination); o.start(); o.stop(ac.currentTime+0.22); }

/** =============================
 *  ğŸ† ç…™ç«ï¼ˆç°¡æ˜“ç´™èŠ±ï¼‰
 *  ============================= */
const fx = document.getElementById('fx');
const ctx = fx.getContext('2d');
function resizeFx(){ fx.width = innerWidth; fx.height = innerHeight; }
addEventListener('resize', resizeFx); resizeFx();
let confetti = [];
function spawnConfetti(){
  if(!state.purchased.fireworks) return;
  for(let i=0;i<120;i++){
    confetti.push({x: fx.width/2, y: fx.height/3, vx:(Math.random()-0.5)*6, vy:Math.random()*-6-2, a:1, r:2+Math.random()*3});
  }
}
function tickFx(){
  ctx.clearRect(0,0,fx.width,fx.height);
  ctx.fillStyle = '#a6b3ff';
  confetti.forEach(p=>{
    p.vy += 0.12; p.x += p.vx; p.y += p.vy; p.a -= 0.01;
    ctx.globalAlpha = Math.max(0,p.a);
    ctx.fillRect(p.x,p.y,p.r,p.r);
  });
  confetti = confetti.filter(p=>p.a>0 && p.y<fx.height+20);
  requestAnimationFrame(tickFx);
}
requestAnimationFrame(tickFx);

/** =============================
 *  ğŸ—‚ï¸ é€±æ¬¡èˆ‡æ¸…å–®
 *  ============================= */
function initWeeks(){
  weekSel.innerHTML = Object.keys(WORDS).map(w=>`<option ${w===state.currentWeek?'selected':''}>${w}</option>`).join('');
  renderList();
}
function renderList(){
  const arr = WORDS[state.currentWeek]||[];
  wordList.innerHTML = `<details open><summary>${state.currentWeek} â€” å…± ${arr.length} å­—</summary>` +
    arr.map(w=>`<div class="word"><span>${w.en}</span><span class="muted">${w.zh}</span></div>`).join('')+`</details>`;
}

/** =============================
 *  ğŸ§ª å‡ºé¡Œæµç¨‹
 *  ============================= */
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }
function startWeek(){
  const pool = WORDS[state.currentWeek]||[];
  const idxs = [...Array(pool.length).keys()];
  state.order = state.purchased.random ? shuffle(idxs) : idxs; // æœ‰è³¼è²·éš¨æ©Ÿæ¨¡å¼æ‰æ‰“äº‚
  state.qIndex = -1; nextQuestion(); save();
}
function nextQuestion(){
  const pool = WORDS[state.currentWeek]||[];
  if(pool.length===0){ feedback.textContent='æ­¤é€±å°šç„¡å–®å­—'; return; }
  state.qIndex = (state.qIndex+1) % pool.length;
  state.currentWord = pool[state.order[state.qIndex]];
  state.played = 0; playedEl.textContent = '0';
  answer.value = ''; answer.focus();
  feedback.textContent = ''; explain.textContent = ''; sentenceEl.textContent='';
  speakOnce();
}
function speakOnce(){ if(!state.currentWord) return; speak(state.currentWord.en); state.played++; playedEl.textContent = String(state.played); }

function check(){
  if(!state.currentWord) return;
  const guess = answer.value.trim(); if(!guess) return;
  const correct = state.currentWord.en.toLowerCase();
  if(guess.toLowerCase()===correct){
    state.streak++;
    const earned = 1 + bonusForStreak(state.streak);
    state.coins += earned;
    feedback.innerHTML = `<span class="good">âœ… ç­”å°ï¼</span> æ­¤é¡Œç²å¾— <span class="earned">${earned}ğŸª™</span>`;
    explain.textContent = `${state.currentWord.en} â€” ${state.currentWord.zh}`;
    if(state.purchased.sentence){ sentenceEl.textContent = `ä¾‹å¥ï¼šThe ${state.currentWord.en} is here.`; }
    if(state.purchased.fireworks) spawnConfetti();
    beep();
    updateHeader(); save();
  }else{
    state.streak = 0;
    feedback.innerHTML = `<span class="bad">âŒ ç­”éŒ¯</span>`;
    explain.textContent = `${state.currentWord.en} â€” ${state.currentWord.zh}`; // ä¾éœ€æ±‚ï¼šç­”éŒ¯ç›´æ¥é¡¯ç¤ºä¸­æ–‡
    if(state.purchased.sentence){ sentenceEl.textContent = `ä¾‹å¥ï¼šI can spell ${state.currentWord.en}.`; }
    updateHeader(); save();
  }
}
function bonusForStreak(n){
  if(n===3) return 1; if(n===5) return 3; if(n===10) return 5; if(n===20) return 10; return 0;
}
function updateHeader(){
  coinsEl.textContent = state.coins; streakEl.textContent = state.streak;
  answerWrap.classList.toggle('cool', !!state.purchased.coolinput);
  if(state.purchased.theme){ document.documentElement.style.setProperty('--bg','#0a1324'); document.documentElement.style.setProperty('--accent','#a78bfa'); }
}

/** =============================
 *  ğŸ›’ å•†åº—
 *  ============================= */
const prices = { fireworks:30, voicepack:20, coolinput:15, theme:25, sound:20, sentence:10, random:10 };
function initStore(){
  document.querySelectorAll('.buy').forEach(btn=>{
    const key = btn.dataset.item;
    const refresh = ()=>{
      if(state.purchased[key]){ btn.textContent='å·²æ“æœ‰'; btn.disabled=true; const priceEl = btn.closest('.store-item').querySelector('.price'); if(priceEl) priceEl.outerHTML='<span class="owned">âœ” å·²æ“æœ‰</span>'; }
    };
    btn.addEventListener('click',()=>{
      if(state.purchased[key]) return;
      const cost = prices[key];
      if(state.coins < cost){ alert('é‡‘å¹£ä¸è¶³ï¼'); return; }
      state.coins -= cost; state.purchased[key]=true; save(); updateHeader(); refresh();
    });
    refresh();
  });
}

/** =============================
 *  ğŸ™ï¸ éŒ„éŸ³ï¼ˆIndexedDB æŒä¹…åŒ–ï¼‰
 *  ============================= */
let media, recorder, chunks=[];
const recBtn = document.getElementById('recBtn');
const playRec = document.getElementById('playRec');
const recStatus = document.getElementById('recStatus');

let db;
const DB_NAME='pierce_audio_v1', STORE='clips';
function idbOpen(){ return new Promise((res,rej)=>{ const r=indexedDB.open(DB_NAME,1); r.onupgradeneeded=()=>{ r.result.createObjectStore(STORE); }; r.onsuccess=()=>res(r.result); r.onerror=()=>rej(r.error); }); }
async function idbPut(key, blob){ db = db || await idbOpen(); return new Promise((res,rej)=>{ const tx=db.transaction(STORE,'readwrite'); tx.objectStore(STORE).put(blob,key); tx.oncomplete=()=>res(); tx.onerror=()=>rej(tx.error); }); }
async function idbGet(key){ db = db || await idbOpen(); return new Promise((res,rej)=>{ const tx=db.transaction(STORE,'readonly'); const g=tx.objectStore(STORE).get(key); g.onsuccess=()=>res(g.result||null); g.onerror=()=>rej(g.error); }); }

function currentKey(){ return `${state.currentWeek}|${state.currentWord?state.currentWord.en:''}`; }

async function startRec(){
  try{
    media = await navigator.mediaDevices.getUserMedia({audio:true});
    recorder = new MediaRecorder(media);
    chunks=[];
    recorder.ondataavailable=e=>{ if(e.data.size>0) chunks.push(e.data); };
    recorder.onstop=async()=>{
      const blob = new Blob(chunks,{type:'audio/webm'});
      try{ await idbPut(currentKey(), blob); playRec.disabled=false; recStatus.textContent='éŒ„éŸ³å·²å„²å­˜'; }catch(e){ console.warn(e); recStatus.textContent='ç„¡æ³•å„²å­˜éŒ„éŸ³'; }
    };
    recorder.start();
    recBtn.textContent='åœæ­¢'; recStatus.textContent='éŒ„éŸ³ä¸­â€¦';
  }catch(e){
    alert('éŒ„éŸ³ä¸å¯ç”¨ï¼šéœ€è¦ https/localhost æˆ–ç€è¦½å™¨æ¬Šé™');
  }
}
function stopRec(){ if(recorder && recorder.state!=='inactive'){ recorder.stop(); media.getTracks().forEach(t=>t.stop()); recBtn.textContent='éŒ„éŸ³'; }
}
recBtn.addEventListener('click',()=>{ if(recorder && recorder.state==='recording'){ stopRec(); } else { startRec(); } });
playRec.addEventListener('click', async()=>{
  const blob = await idbGet(currentKey());
  if(!blob){ alert('æ­¤å–®å­—å°šç„¡éŒ„éŸ³'); return; }
  const url = URL.createObjectURL(blob); const a = new Audio(url); a.play();
});

/** =============================
 *  ğŸ§© äº‹ä»¶èˆ‡åˆå§‹åŒ–
 *  ============================= */
initWeeks(); initStore(); startWeek();

weekSel.addEventListener('change',()=>{ state.currentWeek = weekSel.value; renderList(); startWeek(); save(); });
newQBtn.addEventListener('click', nextQuestion);
replayBtn.addEventListener('click', speakOnce);
submitBtn.addEventListener('click', check);
answer.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ check(); } });
document.addEventListener('keydown', (e)=>{ if(e.key.toLowerCase()==='t'){ speakOnce(); } });

toggleListBtn.addEventListener('click',()=>{ wordList.hidden = !wordList.hidden; });

// å·²æœ‰éŒ„éŸ³å°±å…è¨±æ’­æ”¾
setInterval(async()=>{ if(!state.currentWord) return; const b = await idbGet(currentKey()); playRec.disabled = !b; }, 1200);

// è¦å‰‡å°è©±æ¡†
const dlg = document.getElementById('rulesDlg');
document.getElementById('showRules').onclick=()=>dlg.showModal();
document.getElementById('closeRules').onclick=()=>dlg.close();

  </script>
</body>
</html>