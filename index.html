<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pierce å°ˆç”¨æ‹¼å­—ç·´ç¿’</title>
    <style>
        /* CSS æ¨£å¼ */
        body { font-family: 'Arial', sans-serif; margin: 0; padding: 0; background-color: #f4f4f9; color: #333; }
        #header { position: fixed; top: 0; left: 0; width: 100%; background-color: #4CAF50; color: white; padding: 10px 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 1000; display: flex; justify-content: space-between; align-items: center; }
        #stats { display: flex; gap: 30px; font-size: 1.2em; }
        #stats span { display: flex; align-items: center; }
        .coin-icon { color: gold; font-size: 1.5em; margin-right: 5px; }
        .rule-icon { cursor: pointer; margin-left: 10px; }
        #content { padding-top: 70px; padding-bottom: 20px; max-width: 800px; margin: auto; }
        .section { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h2 { color: #4CAF50; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 0; }

        /* é€±æ¬¡é¸æ“‡ */
        #week-selection select { padding: 10px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; width: 100%; }

        /* ç·´ç¿’å€ */
        #quiz-area { text-align: center; }
        #word-display { font-size: 2em; margin-bottom: 15px; min-height: 40px; }
        #chinese-display { font-size: 1.2em; color: #555; margin-top: 10px; min-height: 20px; }
        #input-container { display: flex; justify-content: center; align-items: center; margin-bottom: 20px; }
        #spelling-input { padding: 10px; font-size: 18px; border-radius: 5px; border: 2px solid #ccc; width: 60%; margin-right: 10px; text-transform: lowercase; }
        #spelling-input:focus { border-color: #4CAF50; outline: none; }
        button { padding: 10px 15px; font-size: 16px; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; margin: 5px; }
        .primary-btn { background-color: #008CBA; color: white; }
        .primary-btn:hover { background-color: #007B9E; }
        .action-btn { background-color: #f44336; color: white; }
        .action-btn:hover { background-color: #da190b; }
        .secondary-btn { background-color: #ff9800; color: white; }
        .secondary-btn:hover { background-color: #e68900; }
        .success-msg { color: green; font-weight: bold; margin-top: 10px; }
        .error-msg { color: red; font-weight: bold; margin-top: 10px; }

        /* éŒ„éŸ³/æç¤ºå€ */
        #recording-section { margin-top: 20px; border-top: 1px dashed #ccc; padding-top: 15px; }
        #recording-controls button { background-color: #3f51b5; }
        #recording-controls button:hover { background-color: #303f9f; }

        /* å•†åº—å€ */
        .shop-item { border: 1px solid #eee; padding: 15px; margin-bottom: 10px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
        .item-info h4 { margin: 0 0 5px 0; color: #3f51b5; }
        .item-info p { margin: 0; font-size: 0.9em; color: #666; }
        .buy-btn { background-color: gold; color: #333; font-weight: bold; }
        .buy-btn:hover { background-color: #e6c200; }

        /* æ¨¡æ…‹æ¡† (é‡‘å¹£è¦å‰‡) */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); }
        .modal-content { background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 400px; border-radius: 10px; }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; }
        .close:hover, .close:focus { color: #000; text-decoration: none; cursor: pointer; }

    </style>
</head>
<body>

    <div id="header">
        <div id="stats">
            <span><span class="coin-icon">ğŸ’°</span>ç›®å‰é‡‘å¹£: <span id="current-coins">0</span></span>
            <span>é€£çºŒç­”å°: <span id="streak-count">0</span> é¡Œ</span>
        </div>
        <div>
            é‡‘å¹£ç²å–è¦å‰‡ <span class="rule-icon" id="rule-btn">â„¹ï¸</span>
            <button id="shop-btn" class="secondary-btn">ğŸ† å•†åº—</button>
        </div>
    </div>

    <div id="content">

        <div id="week-selection" class="section">
            <h2>é€±æ¬¡é¸æ“‡</h2>
            <select id="week-select"></select>
        </div>

        <div id="quiz-area" class="section">
            <h2>æ‹¼å­—ç·´ç¿’</h2>
            <div id="word-display">è«‹é¸æ“‡é€±æ¬¡ä¸¦é»æ“Šã€Œä¸‹ä¸€é¡Œã€é–‹å§‹</div>
            <div id="chinese-display"></div>

            <div id="input-container">
                <input type="text" id="spelling-input" placeholder="è«‹è¼¸å…¥å–®å­—æ‹¼æ³•" disabled>
                <button id="submit-btn" class="primary-btn" disabled>é€å‡ºç­”æ¡ˆ</button>
            </div>

            <button id="repeat-btn" class="secondary-btn" disabled>å†è½ä¸€æ¬¡</button>
            <button id="next-btn" class="primary-btn" disabled>ä¸‹ä¸€é¡Œ</button>

            <div id="message-area"></div>

            <div id="recording-section">
                <h4>éŒ„éŸ³/æç¤º</h4>
                <div id="recording-controls">
                    <button id="record-btn" class="action-btn" disabled>ğŸ”´ éŒ„éŸ³æç¤º (æ¨¡æ“¬)</button>
                    <button id="play-record-btn" disabled>â–¶ æ’­æ”¾æç¤º (æ¨¡æ“¬)</button>
                </div>
                <div id="user-hint"></div>
            </div>

        </div>

        <div id="shop-area" class="section" style="display: none;">
            <h2>ğŸ† å•†åº—</h2>
            <div id="shop-list">
                </div>
        </div>

    </div>

    <div id="rules-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>é‡‘å¹£ç²å–è¦å‰‡</h3>
            <ul>
                <li>æ¯é¡Œç­”å°ï¼š**+1 å¹£**</li>
                <li>ç­”éŒ¯ï¼š**ä¸æ‰£åˆ†**</li>
                <li>é€£çºŒç­”å° Bonus:</li>
                <ul>
                    <li>é€£ 3 é¡Œï¼šé¡å¤– **+1 å¹£**</li>
                    <li>é€£ 5 é¡Œï¼šé¡å¤– **+3 å¹£**</li>
                    <li>é€£ 10 é¡Œï¼šé¡å¤– **+5 å¹£**</li>
                    <li>é€£ 20 é¡Œï¼šé¡å¤– **+10 å¹£**</li>
                </ul>
            </ul>
        </div>
    </div>

    <script>
        // JavaScript é‚è¼¯

        const wordList = {
            'Week 1': [
                ['bank', 'éŠ€è¡Œ'], ['camp', 'éœ²ç‡Ÿ'], ['hand', 'æ‰‹'], ['paint', 'æ²¹æ¼†'], ['plant', 'æ¤ç‰©'], 
                ['pond', 'æ± å¡˜'], ['pump', 'å¹«æµ¦'], ['stamp', 'éƒµç¥¨'], ['stand', 'ç«™ç«‹'], ['stump', 'æ¨¹æ¨'], 
                ['wind', 'é¢¨'], ['wink', 'çœ¨çœ¼'], ['hungry', 'é£¢é¤“çš„'], ['lapping', 'èˆ”ã€æ‹æ‰“ï¼ˆæ°´ï¼‰'], ['milk', 'ç‰›å¥¶'], 
                ['quiet', 'å®‰éœçš„'], ['television', 'é›»è¦–'], ['backyard', 'å¾Œé™¢'], ['basement', 'åœ°ä¸‹å®¤'], 
                ['clean', 'æ‰“æƒ'], ['fly up', 'é£›èµ·ä¾†'], ['keep-away', 'èº²é¿éŠæˆ²'], ['near', 'è¿‘çš„'], ['upstairs', 'æ¨“ä¸Š']
            ],
            'Week 2': [
                ['belt', 'çš®å¸¶'], ['elf', 'å°ç²¾éˆ'], ['gift', 'ç¦®ç‰©'], ['golf', 'é«˜çˆ¾å¤«'], ['left', 'å·¦é‚Š'], 
                ['lift', 'æèµ·'], ['melt', 'èåŒ–'], ['quilt', 'æ£‰è¢«'], ['raft', 'æœ¨ç­'], ['shelf', 'æ¶å­'], 
                ['wilt', 'æ¯è'], ['wolf', 'ç‹¼'], ['came', 'ä¾†äº†'], ['bait', 'é¤Œ'], ['rake', 'è€™å­'], 
                ['hay', 'ä¹¾è‰'], ['plate', 'ç›¤å­'], ['pail', 'æ°´æ¡¶'], ['cane', 'æ‹æ–'], ['raise', 'èˆ‰èµ·'], 
                ['grape', 'è‘¡è„'], ['say', 'èªª'], ['aid', 'å¹«åŠ©'], ['pain', 'ç–¼ç—›'], ['trail', 'å°å¾‘'], 
                ['stain', 'æ±™æ¼¬'], ['blaze', 'ç«ç„°'], ['almost', 'å¹¾ä¹'], ['dishes', 'ç›¤å­'], ['everyone', 'æ¯å€‹äºº'], 
                ['family', 'å®¶äºº'], ['later', 'ä¹‹å¾Œ'], ['soup', 'æ¹¯'], ['still', 'ä»ç„¶'], ['together', 'ä¸€èµ·'], 
                ['window', 'çª—æˆ¶'], ['children', 'å­©å­å€‘'], ['collar', 'é ˜å­'], ['heel', 'è…³è·Ÿ'], ['hurt', 'å—å‚·'], 
                ['in front of', 'åœ¨â€¦å‰é¢'], ['lean', 'å‚¾æ–œ'], ['pet store', 'å¯µç‰©åº—'], ['snort', 'å™´é¼»æ¯']
            ],
            'Week 3': [
                ['scrape', 'åˆ®'], ['scratch', 'æŠ“'], ['screen', 'è¢å¹•'], ['scrub', 'ç”¨åŠ›æ“¦'], ['splash', 'æ¿ºèµ·'], 
                ['split', 'åˆ†é–‹'], ['sprain', 'æ‰­å‚·'], ['spray', 'å™´ç‘'], ['spring', 'æ˜¥å¤© / å½ˆç°§'], ['strap', 'çš®å¸¶'], 
                ['stripes', 'æ¢ç´‹'], ['strong', 'å¼·å£¯çš„'], ['deep', 'æ·±çš„'], ['meal', 'ä¸€é¤'], ['sheep', 'ç¾Š'], 
                ['each', 'æ¯ä¸€å€‹'], ['wheel', 'è¼ªå­'], ['treat', 'æ‹›å¾…'], ['bean', 'è±†å­'], ['seen', 'çœ‹è¦‹ï¼ˆéå»åˆ†è©ï¼‰'], 
                ['team', 'åœ˜éšŠ'], ['dream', 'å¤¢'], ['mean', 'æ„æ€æ˜¯'], ['leave', 'é›¢é–‹'], ['cream', 'å¥¶æ²¹'], 
                ['sleep', 'ç¡è¦º'], ['sneeze', 'æ‰“å™´åš'], ['copies', 'å‰¯æœ¬'], ['enough', 'è¶³å¤ '], ['library', 'åœ–æ›¸é¤¨'], 
                ['number', 'æ•¸å­—'], ['prizes', 'çå“'], ['ribbon', 'ç·å¸¶'], ['ring', 'æˆ’æŒ‡'], ['rope', 'ç¹©å­'], 
                ['sign', 'æ¨™èªŒ'], ['tonight', 'ä»Šæ™š'], ['happen', 'ç™¼ç”Ÿ'], ['miss', 'æƒ³å¿µ'], ['nice', 'å¥½çš„'], 
                ['steps', 'éšæ¢¯'], ['terrible', 'å¯æ€•çš„']
            ],
            'Week 4': [
                ['knee', 'è†è“‹'], ['kneel', 'è·ªä¸‹'], ['knife', 'åˆ€'], ['knit', 'ç·¨ç¹”'], ['knob', 'åœ“å½¢æŠŠæ‰‹'], 
                ['knock', 'æ•²'], ['knot', 'çµ'], ['wrap', 'åŒ…èµ·ä¾†'], ['wreath', 'èŠ±åœˆ'], ['wrench', 'æ‰³æ‰‹'], 
                ['wrist', 'æ‰‹è…•'], ['write', 'å¯«'], ['wrong', 'éŒ¯çš„'], ['shy', 'å®³ç¾çš„'], ['right', 'æ­£ç¢ºçš„ / å³é‚Š'], 
                ['wide', 'å¯¬çš„'], ['light', 'å…‰ / è¼•çš„'], ['pine', 'æ¾æ¨¹'], ['fight', 'æ‰“æ¶'], ['fly', 'é£›'], 
                ['night', 'å¤œæ™š'], ['dry', 'ä¹¾çš„'], ['sight', 'è¦–ç·š'], ['might', 'å¯èƒ½'], ['tight', 'ç·Šçš„'], 
                ['stripe', 'æ¢ç´‹'], ['sly', 'ç‹¡çŒ¾çš„'], ['cry', 'å“­'], ['basket', 'ç±ƒå­'], ['bend down', 'å½ä¸‹'], 
                ['kind', 'è¦ªåˆ‡çš„ / ç¨®é¡'], ['wave', 'æ®æ‰‹ / æ³¢æµª'], ['enter', 'é€²å…¥'], ['never', 'å¾ä¸'], 
                ['picture', 'åœ–ç‰‡'], ['proud', 'é©•å‚²çš„'], ['shiny', 'é–ƒäº®çš„'], ['spray', 'å™´ç‘']
            ],
            'Week 5': [
                ['brick', 'ç£š'], ['check', 'æª¢æŸ¥'], ['chick', 'å°é›'], ['clock', 'æ™‚é˜'], ['duck', 'é´¨å­'], 
                ['lock', 'é–'], ['pocket', 'å£è¢‹'], ['rack', 'æ¶å­'], ['rock', 'å²©çŸ³'], ['rocket', 'ç«ç®­'], 
                ['snack', 'é»å¿ƒ'], ['thick', 'åš'], ['track', 'è»Œé“'], ['poke', 'æˆ³'], ['boat', 'èˆ¹'], 
                ['row', 'åˆ’èˆ¹'], ['goat', 'å±±ç¾Š'], ['snow', 'é›ª'], ['toad', 'èŸ¾èœ'], ['soap', 'è‚¥çš‚'], 
                ['blow', 'å¹'], ['coat', 'å¤–å¥—'], ['tow', 'æ‹–æ‹‰'], ['coach', 'æ•™ç·´'], ['float', 'æ¼‚æµ®'], 
                ['toast', 'åå¸'], ['slow', 'æ…¢çš„'], ['globe', 'åœ°çƒ'], ['at once', 'ç«‹åˆ»'], ['dog toys', 'ç‹—ç©å…·'], 
                ['guess', 'çŒœ'], ['inside', 'è£¡é¢'], ['judge', 'è©•åˆ¤'], ['place', 'åœ°æ–¹']
            ],
            'Week 6': [
                ['bright', 'æ˜äº®çš„'], ['caught', 'æŠ“åˆ°'], ['eight', 'å…«'], ['flight', 'é£›è¡Œ'], ['high', 'é«˜çš„'], 
                ['knight', 'é¨å£«'], ['light', 'å…‰'], ['night', 'å¤œæ™š'], ['right', 'æ­£ç¢ºçš„'], ['sign', 'æ¨™èªŒ'], 
                ['sight', 'è¦–åŠ›'], ['straight', 'ç›´çš„'], ['tight', 'ç·Šçš„'], ['tune', 'æ›²å­'], ['moon', 'æœˆäº®'], 
                ['pool', 'æ¸¸æ³³æ± '], ['zoo', 'å‹•ç‰©åœ’'], ['rude', 'ç²—é­¯çš„'], ['soon', 'å¾ˆå¿«'], ['boot', 'é•·é´'], 
                ['food', 'é£Ÿç‰©'], ['tube', 'ç®¡å­'], ['room', 'æˆ¿é–“'], ['moose', 'éº‹é¹¿'], ['goose', 'éµ'], 
                ['zoom', 'å—–åœ°é£›'], ['balloon', 'æ°£çƒ'], ['shoot', 'å°„æ“Š'], ['a can of', 'ä¸€ç½'], ['enter', 'é€²å…¥'], 
                ['first', 'ç¬¬ä¸€'], ['glitter', 'é–ƒå…‰'], ['gold', 'é‡‘å­'], ['prizes', 'çå“'], ['second', 'ç¬¬äºŒ'], 
                ['sign up', 'å ±å'], ['surely', 'ç•¶ç„¶'], ['third', 'ç¬¬ä¸‰'], ['look at', 'çœ‹è‘—'], ['no cost', 'å…è²»'], 
                ['nod', 'é»é ­'], ['paste', 'é»è²¼'], ['permission', 'è¨±å¯']
            ],
            'Week 7': [
                ['basement', 'åœ°ä¸‹å®¤'], ['bright-eyed', 'çœ¼ç¥æ˜äº®çš„'], ['lean', 'å‚¾æ–œ'], ['past', 'éå»'], 
                ['wrong', 'éŒ¯çš„'], ['remember', 'è¨˜å¾—'], ['clap', 'æ‹æ‰‹'], ['crowd', 'äººç¾¤'], ['hug', 'æ“æŠ±'], 
                ['nervous', 'ç·Šå¼µçš„'], ['people', 'äººå€‘'], ['ring', 'æˆ’æŒ‡ / éˆ´è²']
            ],
            'Week 8': [
                ['different', 'ä¸åŒçš„'], ['hold up', 'èˆ‰èµ·'], ['lay down', 'èººä¸‹'], ['other', 'å…¶ä»–çš„'], 
                ['racehorse', 'è³½é¦¬'], ['win', 'è´'], ['winner', 'å‹åˆ©è€…']
            ],
            'Week 9': [
                ['what', 'ä»€éº¼'], ['clash', 'è¡çª'], ['shock', 'éœ‡é©š'], ['while', 'ç•¶â€¦æ™‚'], ['shame', 'å¯æƒœ'], 
                ['flash', 'é–ƒå…‰'], ['where', 'å“ªè£¡'], ['shine', 'ç™¼äº®'], ['why', 'ç‚ºä»€éº¼'], ['shore', 'æµ·å²¸'], 
                ['shall', 'å°‡è¦'], ['share', 'åˆ†äº«'], ['shadow', 'å½±å­'], ['whisper', 'ä½èª'], ['whiskers', 'é¬é¬š'], 
                ['different', 'ä¸åŒçš„'], ['hold up', 'èˆ‰èµ·'], ['lay down', 'èººä¸‹'], ['other', 'å…¶ä»–çš„'], 
                ['racehorse', 'è³½é¦¬'], ['win', 'è´'], ['winner', 'å„ªå‹è€…'], ['braid', 'è¾®å­'], ['chain', 'éŠæ¢'], 
                ['hay', 'ä¹¾è‰'], ['mail', 'éƒµä»¶'], ['pail', 'æ°´æ¡¶'], ['paint', 'æ²¹æ¼†'], ['pay', 'ä»˜éŒ¢'], 
                ['rain', 'é›¨'], ['sail', 'å¸† / èˆªè¡Œ'], ['stain', 'æ±™æ¼¬'], ['train', 'ç«è»Š'], ['tray', 'æ‰˜ç›¤'], 
                ['beads', 'ç å­'], ['bean', 'è±†å­'], ['beef', 'ç‰›è‚‰'], ['bread', 'éºµåŒ…'], ['head', 'é ­'], 
                ['heel', 'è…³è·Ÿ'], ['leaf', 'è‘‰å­'], ['screen', 'è¢å¹•'], ['seat', 'åº§ä½'], ['steam', 'è’¸æ°£'], 
                ['thread', 'ç·š'], ['tree', 'æ¨¹'], ['climb', 'çˆ¬'], ['myself', 'æˆ‘è‡ªå·±'], ['practice', 'ç·´ç¿’'], 
                ['track', 'è»Œé“'], ['uncle', 'å”å”'], ['whiskers', 'é¬é¬š']
            ],
            'Week 10': [
                ['braid', 'è¾®å­'], ['chain', 'éŠæ¢'], ['hay', 'ä¹¾è‰'], ['nail', 'æŒ‡ç”² / é‡˜å­'], ['pail', 'æ°´æ¡¶'], 
                ['paint', 'æ²¹æ¼†'], ['pay', 'ä»˜éŒ¢'], ['rain', 'é›¨'], ['sail', 'èˆªè¡Œ'], ['stain', 'æ±™é»'], 
                ['beads', 'ç å­'], ['bean', 'è±†å­'], ['beef', 'ç‰›è‚‰'], ['bead', 'ç å­'], ['head', 'é ­'], 
                ['heel', 'è…³è·Ÿ'], ['leaf', 'è‘‰å­'], ['screen', 'è¢å¹•'], ['seat', 'åº§ä½'], ['steam', 'è’¸æ°£'], 
                ['thread', 'ç·š'], ['tree', 'æ¨¹'], ['climb', 'çˆ¬'], ['myself', 'æˆ‘è‡ªå·±'], ['practice', 'ç·´ç¿’'], 
                ['track', 'è»Œé“'], ['uncle', 'å”å”'], ['whiskers', 'é¬é¬š'], ['wrote', 'å¯«äº†'], ['clover', 'é…¢æ¼¿è‰'], 
                ['danger', 'å±éšª'], ['field', 'ç”°é‡'], ['noise', 'å™ªéŸ³'], ['pass', 'ç¶“é'], ['rest', 'ä¼‘æ¯'], 
                ['rumble', 'éš†éš†è²'], ['sky', 'å¤©ç©º'], ['thunder', 'é›·']
            ],
            'Week 11': [
                ['blow', 'å¹'], ['bowl', 'ç¢—'], ['crow', 'çƒé´‰'], ['goat', 'å±±ç¾Š'], ['pillow', 'æ•é ­'], 
                ['road', 'é“è·¯'], ['snow', 'é›ª'], ['soap', 'è‚¥çš‚'], ['throw', 'ä¸Ÿ'], ['toad', 'èŸ¾èœ'], 
                ['toast', 'åå¸'], ['window', 'çª—æˆ¶'], ['bath', 'æ´—æ¾¡'], ['peach', 'æ¡ƒå­'], ['tooth', 'ç‰™é½’'], 
                ['thin', 'ç˜¦çš„'], ['choke', 'å™åˆ°'], ['much', 'å¾ˆå¤š'], ['with', 'å’Œ'], ['chick', 'å°é›'], 
                ['teach', 'æ•™'], ['thank', 'æ„Ÿè¬'], ['child', 'å°å­©'], ['chore', 'å®¶äº‹'], ['reach', 'åˆ°é”'], 
                ['thick', 'åš'], ['think', 'æ€è€ƒ'], ['carrot', 'èƒ¡è˜¿è””'], ['cool', 'æ¶¼çš„'], ['gloves', 'æ‰‹å¥—'], 
                ['haircut', 'ç†é«®'], ['patch', 'è£œä¸'], ['pond', 'æ± å¡˜'], ['spring', 'æ˜¥å¤©'], ['voice', 'è²éŸ³'], 
                ['wool', 'ç¾Šæ¯›'], ['acorn', 'æ©¡å­'], ['angry', 'ç”Ÿæ°£çš„'], ['as fast as', 'ç›¡å¯èƒ½å¿«'], ['bless', 'ç¥ç¦'], 
                ['chattering', 'å–‹å–‹ä¸ä¼‘'], ['dig', 'æŒ–'], ['hill', 'å°å±±'], ['oak', 'æ©¡æ¨¹'], ['squirrel', 'æ¾é¼ '], 
                ['thief', 'å°å·'], ['tiny', 'å¾ˆå°çš„']
            ],
            'Week 12': [
                ['boot', 'é•·é´'], ['cook', 'ç…®'], ['hood', 'å¸½å…œ'], ['hook', 'é‰¤å­'], ['hoop', 'åœˆ'], 
                ['moose', 'éº‹é¹¿'], ['pool', 'æ¸¸æ³³æ± '], ['school', 'å­¸æ ¡'], ['shook', 'æ–å‹•ï¼ˆéå»å¼ï¼‰'], 
                ['spoon', 'æ¹¯åŒ™'], ['stood', 'ç«™ç«‹ï¼ˆéå»å¼ï¼‰'], ['stool', 'å‡³å­'], ['cause', 'åŸå› '], 
                ['claw', 'çˆª'], ['crawl', 'çˆ¬è¡Œ'], ['draw', 'ç•«'], ['faucet', 'æ°´é¾é ­'], ['fawn', 'å°é¹¿'], 
                ['laundry', 'æ´—è¡£'], ['paw', 'çˆªå­'], ['sauce', 'é†¬æ±'], ['shawl', 'æŠ«å·¾'], 
                ['straw', 'å¸ç®¡ / ç¨»è‰'], ['yawn', 'æ‰“å“ˆæ¬ '], ['behind', 'åœ¨å¾Œé¢'], ['berry', 'æ¼¿æœ'], 
                ['branches', 'æ¨¹æ'], ['bushy tail', 'æ¯›èŒ¸èŒ¸çš„å°¾å·´'], ['dance', 'è·³èˆ'], ['flag', 'æ——å­'], 
                ['insect', 'æ˜†èŸ²'], ['quick', 'å¿«çš„'], ['skunk', 'è‡­é¼¬'], ['suddenly', 'çªç„¶åœ°']
            ],
            'Week 13': [
                ['blew', 'å¹äº†'], ['chew', 'å’€åš¼'], ['dew', 'éœ²æ°´'], ['few', 'å°‘æ•¸'], ['flew', 'é£›äº†'], 
                ['grew', 'æˆé•·'], ['jewelry', 'ç å¯¶'], ['mew', 'è²“å«'], ['new', 'æ–°çš„'], ['screw', 'èºçµ²'], 
                ['stew', 'ç‡‰èœ'], ['threw', 'ä¸Ÿäº†'], ['art', 'è—è¡“'], ['yard', 'é™¢å­'], ['barn', 'ç©€å€‰'], 
                ['park', 'å…¬åœ’'], ['hard', 'å›°é›£çš„'], ['cart', 'æ‰‹æ¨è»Š'], ['dark', 'é»‘æš—'], ['farm', 'è¾²å ´'], 
                ['shark', 'é¯Šé­š'], ['sharp', 'éŠ³åˆ©çš„'], ['harm', 'å‚·å®³'], ['alarm', 'é¬§é˜'], ['arms', 'æ‰‹è‡‚'], 
                ['march', 'ä¸‰æœˆ / è¡Œé€²'], ['smart', 'è°æ˜çš„'], ['buzzing', 'å—¡å—¡è²'], ['careful', 'å°å¿ƒçš„'], 
                ['fur', 'æ¯›'], ['hit', 'æ‰“'], ['hole', 'æ´'], ['honey', 'èœ‚èœœ'], ['lick', 'èˆ”'], ['path', 'å°è·¯'], 
                ['sting', 'è«'], ['stuck', 'å¡ä½çš„'], ['against', 'åå°'], ['hardly', 'å¹¾ä¹ä¸'], ['meadow', 'è‰åœ°'], 
                ['middle', 'ä¸­é–“'], ['pit-pat', 'å™ å™ è²'], ['space', 'ç©ºé–“'], ['toss', 'ä¸Ÿ'], ['touch', 'è§¸ç¢°'], 
                ['whistle', 'å£å“¨']
            ],
            // Week 14 missing in provided list, skipping to Week 15
            'Week 15': [
                ['baby', 'å¬°å…’'], ['bunny', 'å°å…”å­'], ['city', 'åŸå¸‚'], ['cry', 'å“­'], ['dry', 'ä¹¾çš„'], 
                ['fly', 'é£›'], ['fry', 'ç‚¸'], ['happy', 'å¿«æ¨‚çš„'], ['party', 'æ´¾å°'], ['pony', 'å°é¦¬'], 
                ['silly', 'å‚»çš„'], ['sky', 'å¤©ç©º'], ['story', 'æ•…äº‹'], ['chain', 'éˆå­'], ['chop', 'åˆ‡'], 
                ['shed', 'æ£šå­'], ['shelf', 'æ¶å­'], ['thick', 'åš'], ['thin', 'ç˜¦çš„'], ['think', 'æ€è€ƒ'], 
                ['thread', 'ç·š'], ['three', 'ä¸‰'], ['throat', 'å–‰åš¨'], ['whale', 'é¯¨é­š'], ['wheel', 'è¼ªå­'], 
                ['shines', 'ç™¼å…‰'], ['through', 'ç©¿é'], ['bouncing', 'å½ˆè·³çš„'], ['spider', 'èœ˜è››'], ['webs', 'ç¶²'], 
                ['woods', 'æ¨¹æ—'], ['glass', 'ç»ç’ƒ'], ['tied together', 'ç¶åœ¨ä¸€èµ·'], ['drop', 'æ‰ä¸‹'], 
                ['straight', 'ç›´çš„'], ['friendly', 'å‹å–„çš„'], ['bless', 'ç¥ç¦'], ['blink', 'çœ¨çœ¼'], ['crawl', 'çˆ¬'], 
                ['flat', 'å¹³çš„'], ['follow', 'è·Ÿéš¨'], ['join', 'åŠ å…¥'], ['rock', 'å²©çŸ³'], ['star', 'æ˜Ÿæ˜Ÿ'], 
                ['swish', 'å”°åœ°ä¸€è²']
            ],
            'Week 16': [
                ['bath', 'æ´—æ¾¡'], ['bench', 'é•·å‡³'], ['branch', 'æ¨¹æ'], ['brush', 'åˆ·å­'], ['dish', 'ç›¤å­'], 
                ['ditch', 'æºæ¸ '], ['path', 'å°å¾‘'], ['ring', 'æˆ’æŒ‡'], ['swing', 'ç›ªé¦éŸ†'], ['switch', 'é–‹é—œ'], 
                ['teeth', 'ç‰™é½’'], ['watch', 'æ‰‹éŒ¶'], ['bird', 'é³¥'], ['more', 'æ›´å¤š'], ['shirt', 'è¥¯è¡«'], 
                ['horse', 'é¦¬'], ['first', 'ç¬¬ä¸€'], ['for', 'ç‚ºäº†'], ['girl', 'å¥³å­©'], ['horn', 'è§’'], 
                ['dirt', 'æ³¥åœŸ'], ['short', 'çŸ­çš„'], ['store', 'å•†åº—'], ['morning', 'æ—©æ™¨'], ['dinosaur', 'æé¾'], 
                ['third', 'ç¬¬ä¸‰'], ['whirl', 'æ—‹è½‰'], ['appear', 'å‡ºç¾'], ['decide', 'æ±ºå®š'], ['furry', 'æ¯›èŒ¸èŒ¸çš„'], 
                ['sister', 'å§å¦¹'], ['strange', 'å¥‡æ€ªçš„'], ['tease', 'å–ç¬‘']
            ],
            'Week 17': [
                ['barn', 'ç©€å€‰'], ['card', 'å¡ç‰‡'], ['dart', 'é£›é¢'], ['fern', 'è•¨é¡'], ['harp', 'è±ç´'], 
                ['ladder', 'æ¢¯å­'], ['letter', 'ä¿¡'], ['number', 'æ•¸å­—'], ['paper', 'ç´™'], ['shark', 'é¯Šé­š'], 
                ['slipper', 'æ‹–é‹'], ['water', 'æ°´'], ['yard', 'é™¢å­'], ['flutter', 'æ‹å‹•'], ['flyer', 'å‚³å–®'], 
                ['minute', 'åˆ†é˜'], ['nearby', 'é™„è¿‘'], ['reach', 'åˆ°é”'], ['seem', 'ä¼¼ä¹'], ['throat', 'å–‰åš¨'], 
                ['hummingbird', 'èœ‚é³¥'], ['afraid', 'å®³æ€•'], ['exclaimed', 'é©šå‘¼'], ['frightened', 'å®³æ€•çš„'], 
                ['lift', 'æŠ¬èµ·'], ['shut', 'é—œä¸Š'], ['stretch', 'ä¼¸å±•'], ['wide', 'å¯¬çš„']
            ],
            'Week 18': [
                ['cork', 'è»Ÿæœ¨å¡'], ['corn', 'ç‰ç±³'], ['dirt', 'æ³¥åœŸ'], ['fork', 'å‰å­'], ['horn', 'è§’'], 
                ['shirt', 'è¥¯è¡«'], ['short', 'çŸ­çš„'], ['skirt', 'è£™å­'], ['squirt', 'å™´å‡º'], ['stir', 'æ”ªæ‹Œ'], 
                ['storm', 'æš´é¢¨é›¨'], ['third', 'ç¬¬ä¸‰'], ['thorn', 'èŠæ£˜'], ['burn', 'ç‡’'], ['curb', 'è·¯é‚Š'], 
                ['curl', 'æ²æ›²'], ['fur', 'æ¯›'], ['hurt', 'å—å‚·'], ['turn', 'è½‰å½'], ['does', 'åšï¼ˆç¬¬ä¸‰äººç¨±ï¼‰'], 
                ['were', 'æ˜¯ï¼ˆéå»å¼ï¼‰'], ['every', 'æ¯å€‹'], ['very', 'éå¸¸'], ['give', 'çµ¦'], ['live', 'ç”Ÿæ´»'], 
                ['thing', 'æ±è¥¿'], ['your', 'ä½ çš„'], ['many', 'è¨±å¤š'], ['who', 'èª°'], ['any', 'ä»»ä½•'], 
                ['away', 'é›¢é–‹'], ['goes', 'å»ï¼ˆç¬¬ä¸‰äººç¨±ï¼‰'], ['find', 'æ‰¾åˆ°'], ['kind', 'ç¨®é¡ / å¥½çš„'], 
                ['ago', 'ä»¥å‰'], ['another', 'å¦ä¸€å€‹'], ['corner', 'è§’è½'], ['everywhere', 'åˆ°è™•'], ['fold', 'æ‘º'], 
                ['important', 'é‡è¦çš„'], ['mouse', 'è€é¼ '], ['neck', 'è„–å­'], ['owl', 'è²“é ­é·¹'], ['sharp', 'éŠ³åˆ©çš„'], 
                ['size', 'å°ºå¯¸'], ['supper', 'æ™šé¤'], ['argue', 'çˆ­åµ'], ['bright', 'æ˜äº®çš„'], ['button', 'éˆ•æ‰£'], 
                ['chuckle', 'è¼•ç¬‘'], ['ladybug', 'ç“¢èŸ²'], ['prettiest', 'æœ€æ¼‚äº®çš„'], ['shout', 'å«å–Š'], 
                ['spots', 'æ–‘é»'], ['whole', 'æ•´å€‹çš„']
            ]
        };

        const storeItems = [
            { id: 1, name: "â­ é–ƒäº®ç…™ç«åŒ…", cost: 10, description: "è§£é–ç…™ç«å‹•ç•«ï¼Œç­”å°æ™‚éš¨æ©Ÿæ’­æ”¾ï¼" },
            { id: 2, name: "ğŸ¤– æ©Ÿå™¨äººèªéŸ³åŒ…", cost: 5, description: "å°‡æœ—è®€èªéŸ³æ›æˆæœ‰è¶£çš„æ©Ÿå™¨äººè²ï¼" },
            { id: 3, name: "ğŸ© ç¥ç§˜å¸½é€ å‹", cost: 15, description: "è§£é– Pierce å°ˆå±¬ç¶²ç«™ç¥ç§˜å¸½è¦–è¦º" },
            { id: 4, name: "ğŸ‰ æ´¾å°èƒŒæ™¯ä¸»é¡Œ", cost: 20, description: "è®Šæ›´ç¶²ç«™èƒŒæ™¯é¡è‰²èˆ‡æ¨£å¼" },
            { id: 5, name: "ğŸµ å‹åˆ©éŸ³æ•ˆåŒ…", cost: 8, description: "æ›´æ›ç­”å°æ™‚çš„éŸ³æ•ˆ" },
        ];

        // ç‹€æ…‹è®Šé‡
        let currentCoins = 0;
        let streak = 0;
        let currentWeekWords = [];
        let currentWordIndex = -1;
        let currentWord = '';
        let currentChinese = '';
        let quizState = 'pending'; // 'pending', 'answering', 'answered'
        let purchasedItems = new Set();
        let userRecordedHint = {}; // å„²å­˜ { word: 'hint_text' }

        // DOM å…ƒç´ 
        const weekSelect = document.getElementById('week-select');
        const coinDisplay = document.getElementById('current-coins');
        const streakDisplay = document.getElementById('streak-count');
        const wordDisplay = document.getElementById('word-display');
        const chineseDisplay = document.getElementById('chinese-display');
        const input = document.getElementById('spelling-input');
        const submitBtn = document.getElementById('submit-btn');
        const repeatBtn = document.getElementById('repeat-btn');
        const nextBtn = document.getElementById('next-btn');
        const messageArea = document.getElementById('message-area');
        const recordBtn = document.getElementById('record-btn');
        const playRecordBtn = document.getElementById('play-record-btn');
        const shopArea = document.getElementById('shop-area');
        const shopList = document.getElementById('shop-list');
        const shopBtn = document.getElementById('shop-btn');
        const rulesModal = document.getElementById('rules-modal');
        const ruleBtn = document.getElementById('rule-btn');
        const modalClose = document.getElementsByClassName('close')[0];
        const userHintDisplay = document.getElementById('user-hint');

        // åˆå§‹åŒ–
        function init() {
            loadState();
            populateWeekSelect();
            updateStatsDisplay();
            setupEventListeners();
            renderShop();
            setupVoiceSelection(); // ç¢ºä¿èªéŸ³åˆæˆå°è±¡å¯ç”¨
        }

        // è¼‰å…¥/å„²å­˜ç‹€æ…‹ (ä½¿ç”¨ localStorage å¯¦ç¾é›¢ç·šæŒä¹…åŒ–)
        function saveState() {
            localStorage.setItem('pierce_coins', currentCoins);
            localStorage.setItem('pierce_streak', streak);
            localStorage.setItem('pierce_purchased', JSON.stringify(Array.from(purchasedItems)));
            localStorage.setItem('pierce_hints', JSON.stringify(userRecordedHint));
        }

        function loadState() {
            currentCoins = parseInt(localStorage.getItem('pierce_coins') || '0');
            streak = parseInt(localStorage.getItem('pierce_streak') || '0');
            const savedPurchased = localStorage.getItem('pierce_purchased');
            if (savedPurchased) {
                purchasedItems = new Set(JSON.parse(savedPurchased));
            }
            const savedHints = localStorage.getItem('pierce_hints');
            if (savedHints) {
                userRecordedHint = JSON.parse(savedHints);
            }
        }

        // å¡«å……é€±æ¬¡é¸æ“‡ä¸‹æ‹‰èœå–®
        function populateWeekSelect() {
            let options = '<option value="">-- è«‹é¸æ“‡é€±æ¬¡ --</option>';
            for (let i = 1; i <= 18; i++) {
                if (wordList[`Week ${i}`]) {
                    options += `<option value="Week ${i}">Week ${i}</option>`;
                }
            }
            weekSelect.innerHTML = options;
        }

        // è¨­ç½®äº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            weekSelect.addEventListener('change', startNewWeek);
            nextBtn.addEventListener('click', loadNextWord);
            repeatBtn.addEventListener('click', () => speakWord(currentWord));
            submitBtn.addEventListener('click', checkSpelling);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && quizState === 'answering') {
                    checkSpelling();
                }
            });
            shopBtn.addEventListener('click', toggleShop);
            ruleBtn.addEventListener('click', () => rulesModal.style.display = 'block');
            modalClose.addEventListener('click', () => rulesModal.style.display = 'none');
            window.addEventListener('click', (event) => {
                if (event.target === rulesModal) {
                    rulesModal.style.display = 'none';
                }
            });

            // éŒ„éŸ³/æ’­æ”¾ (æ¨¡æ“¬åŠŸèƒ½)
            recordBtn.addEventListener('click', simulateRecordHint);
            playRecordBtn.addEventListener('click', playRecordedHint);
        }

        // èªéŸ³æœ—è®€è¨­ç½®
        let speaker = null;
        let voice = null;
        function setupVoiceSelection() {
             speaker = window.speechSynthesis;
             // å˜—è©¦é¸æ“‡ä¸€å€‹è‹±æ–‡å¥³è²æˆ–ç”·è²
             speaker.onvoiceschanged = () => {
                const voices = speaker.getVoices();
                voice = voices.find(v => v.lang === 'en-US' && v.name.includes('Google US English')); // å„ªå…ˆé¸æ“‡
                if (!voice) {
                    voice = voices.find(v => v.lang.startsWith('en')); // å‚™ç”¨
                }
                // å¦‚æœè³¼è²·äº†æ©Ÿå™¨äººèªéŸ³åŒ…ï¼Œå¯ä»¥å˜—è©¦è¨­ç½®ä¸åŒçš„ voice
                if (purchasedItems.has(2)) {
                    voice = voices.find(v => v.name.includes('Robot') || v.name.includes('Vicki') || v.name.includes('Alex'));
                }
             };
             // ç«‹å³å˜—è©¦ç²å–ï¼Œä»¥é˜²äº‹ä»¶æ²’æœ‰è§¸ç™¼
             const voices = speaker.getVoices();
             if(voices.length > 0) setupVoiceSelection();
        }


        // æœ—è®€å–®å­— (TTS)
        function speakWord(word) {
            if (!speaker) {
                messageArea.innerHTML = '<div class="error-msg">èªéŸ³åˆæˆä¸å¯ç”¨ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨è¨­å®šã€‚</div>';
                return;
            }
            if (speaker.speaking) {
                speaker.cancel();
            }
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = 'en-US';
            if (voice) {
                utterance.voice = voice;
            } else {
                // å¦‚æœæ²’æœ‰æ‰¾åˆ°ç‰¹å®š voiceï¼Œä½¿ç”¨é è¨­å€¼
                utterance.pitch = purchasedItems.has(2) ? 0.5 : 1; // æ©Ÿå™¨äººè²èª¿
                utterance.rate = purchasedItems.has(2) ? 0.9 : 1; // æ©Ÿå™¨äººé€Ÿåº¦
            }
            speaker.speak(utterance);
        }

        // é–‹å§‹æ–°çš„é€±æ¬¡
        function startNewWeek() {
            const selectedWeek = weekSelect.value;
            if (!selectedWeek) {
                currentWeekWords = [];
                resetQuizArea();
                wordDisplay.textContent = 'è«‹é¸æ“‡é€±æ¬¡ä¸¦é»æ“Šã€Œä¸‹ä¸€é¡Œã€é–‹å§‹';
                nextBtn.disabled = true;
                return;
            }
            currentWeekWords = [...wordList[selectedWeek]]; // è¤‡è£½é™£åˆ—ï¼Œé¿å…ä¿®æ”¹åŸå§‹æ•¸æ“š
            shuffleArray(currentWeekWords);
            currentWordIndex = -1;
            resetQuizArea();
            wordDisplay.textContent = `${selectedWeek} å·²è¼‰å…¥ã€‚æº–å‚™å¥½äº†å—ï¼Ÿ`;
            nextBtn.disabled = false;
        }

        // è¼‰å…¥ä¸‹ä¸€é¡Œ
        function loadNextWord() {
            if (currentWeekWords.length === 0) {
                wordDisplay.textContent = 'æœ¬é€±å–®å­—å·²å…¨éƒ¨å®Œæˆï¼è«‹é¸æ“‡å…¶ä»–é€±æ¬¡ã€‚';
                chineseDisplay.textContent = '';
                resetQuizArea();
                nextBtn.disabled = true;
                return;
            }

            // é‡ç½®ç‹€æ…‹
            resetQuizArea();
            quizState = 'answering';

            // å–å¾—ä¸‹ä¸€çµ„å–®å­—
            currentWordIndex = (currentWordIndex + 1) % currentWeekWords.length;
            const [word, chinese] = currentWeekWords[currentWordIndex];
            currentWord = word.toLowerCase(); // è½‰æ›ç‚ºå°å¯«ä»¥ç¢ºä¿æª¢æŸ¥ä¸€è‡´æ€§
            currentChinese = chinese;

            // é¡¯ç¤ºèˆ‡æ§åˆ¶
            wordDisplay.textContent = 'ğŸ§ æ­£åœ¨æœ—è®€...';
            chineseDisplay.textContent = ''; // éš±è—ä¸­æ–‡
            input.value = '';
            input.disabled = false;
            submitBtn.disabled = false;
            repeatBtn.disabled = false;
            nextBtn.disabled = true;
            
            // è‡ªå‹•æœ—è®€
            speakWord(currentWord);

            // æª¢æŸ¥æ˜¯å¦æœ‰éŒ„éŸ³æç¤º
            if (userRecordedHint[currentWord]) {
                userHintDisplay.innerHTML = `**æ‚¨çš„æç¤ºï¼š** <span style="color: blue;">"${userRecordedHint[currentWord]}"</span>`;
                playRecordBtn.disabled = false;
            } else {
                userHintDisplay.innerHTML = 'æ‚¨é‚„æ²’æœ‰ç‚ºé€™å€‹è©éŒ„è£½æç¤ºã€‚';
                playRecordBtn.disabled = true;
            }
            recordBtn.disabled = false;

            wordDisplay.textContent = 'â“ è«‹æ‹¼å¯«å–®å­—...';
        }

        // æª¢æŸ¥æ‹¼å¯«
        function checkSpelling() {
            if (quizState !== 'answering') return;

            const answer = input.value.trim().toLowerCase();
            const correctWord = currentWord;

            if (answer === correctWord) {
                // ç­”å°
                quizState = 'answered';
                
                // è¨ˆç®—é‡‘å¹£
                const coinsEarned = calculateCoins();
                currentCoins += coinsEarned;
                streak++;
                
                // é¡¯ç¤ºçµæœ
                wordDisplay.textContent = `âœ… æ­£ç¢ºæ‹¼å­—: ${correctWord}`;
                chineseDisplay.textContent = `ä¸­æ–‡: ${currentChinese}`;
                messageArea.innerHTML = `<div class="success-msg">æ­å–œï¼ç­”å°äº†ï¼ğŸ‰ ç²å¾— ${coinsEarned} å¹£ã€‚é€£çºŒç­”å° ${streak} é¡Œï¼</div>`;
                
                // è¦–è¦ºæ•ˆæœ (ç…™ç«/éŸ³æ•ˆ)
                applyShopEffects('win');

                // æ›´æ–°ç‹€æ…‹å’Œæ§åˆ¶
                updateStatsDisplay();
                saveState();
                disableQuizControls(true);

            } else {
                // ç­”éŒ¯
                streak = 0; // é€£çºŒç­”å°æ­¸é›¶
                updateStatsDisplay();
                messageArea.innerHTML = '<div class="error-msg">âŒ ç­”éŒ¯äº†ï¼Œè«‹å†è©¦ä¸€æ¬¡ï¼</div>';
                input.value = ''; // æ¸…ç©ºè¼¸å…¥æ¡†
                input.focus(); // ä¿æŒç„¦é»
            }
        }

        // è¨ˆç®—é‡‘å¹£
        function calculateCoins() {
            let baseCoin = 1;
            let bonusCoin = 0;

            // é€£çºŒç­”å° bonus æ©Ÿåˆ¶ï¼šé€™è£¡è¨ˆç®—çš„æ˜¯ã€Œå¦‚æœé€™æ¬¡ç­”å°ï¼Œå°‡æœƒé”åˆ°çš„é€£çºŒç­”å°æ•¸ã€
            const newStreak = streak + 1;

            if (newStreak >= 20 && newStreak % 20 === 0) {
                 bonusCoin = 10;
            } else if (newStreak >= 10 && newStreak % 10 === 0) {
                 bonusCoin = 5;
            } else if (newStreak >= 5 && newStreak % 5 === 0) {
                bonusCoin = 3;
            } else if (newStreak >= 3 && newStreak % 3 === 0) {
                bonusCoin = 1;
            }

            return baseCoin + bonusCoin;
        }

        // é‡ç½®æ¸¬é©—å€åŸŸ
        function resetQuizArea() {
            quizState = 'pending';
            currentWord = '';
            currentChinese = '';
            wordDisplay.textContent = 'è«‹é»æ“Šã€Œä¸‹ä¸€é¡Œã€é–‹å§‹';
            chineseDisplay.textContent = '';
            input.value = '';
            messageArea.innerHTML = '';
            userHintDisplay.innerHTML = '';
            disableQuizControls(false);
        }

        // ç¦ç”¨/å•Ÿç”¨æ¸¬é©—æ§åˆ¶é …
        function disableQuizControls(isAnswered) {
            input.disabled = isAnswered;
            submitBtn.disabled = isAnswered;
            repeatBtn.disabled = isAnswered;
            nextBtn.disabled = !isAnswered && currentWeekWords.length > 0;
            recordBtn.disabled = isAnswered;
            playRecordBtn.disabled = isAnswered;

            if (!isAnswered && weekSelect.value) {
                // æº–å‚™ç­”é¡Œ
                input.disabled = false;
                submitBtn.disabled = false;
                repeatBtn.disabled = false;
            } else if (!weekSelect.value) {
                 // å°šæœªé¸æ“‡é€±æ¬¡
                 nextBtn.disabled = true;
            } else if (currentWeekWords.length === 0) {
                nextBtn.disabled = true;
            }
        }

        // æ›´æ–°é ‚éƒ¨ç‹€æ…‹æ¬„
        function updateStatsDisplay() {
            coinDisplay.textContent = currentCoins;
            streakDisplay.textContent = streak;
        }

        // æ··æ´—é™£åˆ— (Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // å•†åº—åŠŸèƒ½
        function renderShop() {
            shopList.innerHTML = '';
            storeItems.forEach(item => {
                const isPurchased = purchasedItems.has(item.id);
                const itemDiv = document.createElement('div');
                itemDiv.className = 'shop-item';
                itemDiv.innerHTML = `
                    <div class="item-info">
                        <h4>${item.name} ${isPurchased ? '(å·²æ“æœ‰)' : ''}</h4>
                        <p>${item.description}</p>
                    </div>
                    ${isPurchased 
                        ? '<button disabled>å·²è³¼è²·</button>' 
                        : `<button class="buy-btn" data-id="${item.id}" data-cost="${item.cost}">è³¼è²· (${item.cost} ğŸ’°)</button>`
                    }
                `;
                shopList.appendChild(itemDiv);
            });

            // ç‚ºæ–°çš„è³¼è²·æŒ‰éˆ•æ·»åŠ äº‹ä»¶ç›£è½å™¨
            shopList.querySelectorAll('.buy-btn:not([disabled])').forEach(button => {
                button.addEventListener('click', buyItem);
            });
        }

        function buyItem(event) {
            const id = parseInt(event.target.getAttribute('data-id'));
            const cost = parseInt(event.target.getAttribute('data-cost'));
            const item = storeItems.find(i => i.id === id);

            if (currentCoins >= cost) {
                currentCoins -= cost;
                purchasedItems.add(id);
                updateStatsDisplay();
                saveState();
                renderShop();
                alert(`æ­å–œæ‚¨è³¼è²·äº† ${item.name}ï¼ğŸ‰`);
                
                // åŸ·è¡Œè³¼è²·å¾Œçš„å‹•ä½œ (ä¾‹å¦‚ï¼šæ›´æ–°èªéŸ³è¨­å®š)
                if (id === 2) { // æ©Ÿå™¨äººèªéŸ³åŒ…
                     setupVoiceSelection();
                }

            } else {
                alert(`é‡‘å¹£ä¸è¶³ï¼æ‚¨éœ€è¦ ${cost} å¹£æ‰èƒ½è³¼è²· ${item.name}ã€‚`);
            }
        }

        function toggleShop() {
            if (shopArea.style.display === 'none') {
                shopArea.style.display = 'block';
                renderShop(); // æ¯æ¬¡é–‹å•Ÿéƒ½é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°ç‹€æ…‹
            } else {
                shopArea.style.display = 'none';
            }
        }

        // æ¨¡æ“¬éŒ„éŸ³åŠŸèƒ½
        function simulateRecordHint() {
             if (!currentWord) return;
             const hint = prompt(`è«‹ç‚ºå–®å­—ã€Œ${currentWord}ã€éŒ„è£½/è¼¸å…¥ä¸€å€‹æç¤º (ä¾‹å¦‚ï¼šåª½åª½èªªçš„ä¸­æ–‡ï¼Œæˆ–ä¸€å€‹å°æ•…äº‹)ï¼š`);
             if (hint && hint.trim()) {
                 userRecordedHint[currentWord] = hint.trim();
                 userHintDisplay.innerHTML = `**æ‚¨çš„æç¤ºï¼š** <span style="color: blue;">"${hint.trim()}"</span> (å·²å„²å­˜)`;
                 playRecordBtn.disabled = false;
                 saveState();
                 alert(`æç¤ºå·²ç‚ºã€Œ${currentWord}ã€å„²å­˜ï¼`);
             }
        }

        function playRecordedHint() {
            if (userRecordedHint[currentWord]) {
                alert(`æ’­æ”¾æç¤º (æ¨¡æ“¬)ï¼š\n\n${userRecordedHint[currentWord]}`);
            } else {
                alert('é€™å€‹å–®å­—æ²’æœ‰éŒ„è£½æç¤ºã€‚');
            }
        }

        // æ‡‰ç”¨å•†åº—æ•ˆæœ
        function applyShopEffects(type) {
             if (type === 'win' && purchasedItems.has(1)) { // é–ƒäº®ç…™ç«åŒ…
                 // ç°¡å–®æ¨¡æ“¬ç…™ç«æ•ˆæœ
                 const fireworks = ['âœ¨', 'ğŸ’¥', 'ğŸ†', 'ğŸ’«', 'ğŸŒŸ'];
                 const effect = fireworks[Math.floor(Math.random() * fireworks.length)];
                 messageArea.innerHTML += ` ${effect}`;
             }
             if (type === 'win' && purchasedItems.has(5)) { // å‹åˆ©éŸ³æ•ˆåŒ…
                  // æ’­æ”¾è‡ªå®šç¾©éŸ³æ•ˆï¼ˆéœ€è¦éŸ³é »æ–‡ä»¶ï¼Œé€™è£¡åƒ…æ¨¡æ“¬ï¼‰
                  console.log('æ’­æ”¾å‹åˆ©éŸ³æ•ˆï¼');
             }
             if (purchasedItems.has(3)) { // ç¥ç§˜å¸½é€ å‹
                 document.querySelector('#header').style.backgroundColor = '#6A1B9A'; // è®Šæ›´é¡è‰²æ¨¡æ“¬é€ å‹
             }
             if (purchasedItems.has(4)) { // æ´¾å°èƒŒæ™¯ä¸»é¡Œ
                 document.body.style.backgroundColor = '#E0F7FA'; // è®Šæ›´èƒŒæ™¯è‰²
             }
        }


        // ç¨‹å¼å•Ÿå‹•
        init();

    </script>

</body>
</html>
