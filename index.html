<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pierce å°ˆç”¨æ‹¼å­—ç·´ç¿’ â€” é›¢ç·šç‰ˆ v6</title>
  <style>
    body{font-family:'Segoe UI',sans-serif;background:#0d1224;color:#e8ecff;margin:0;padding-top:80px}
    header{position:fixed;top:0;left:0;right:0;background:#131a35;padding:10px 20px;display:flex;align-items:center;justify-content:space-between;z-index:10;box-shadow:0 2px 8px rgba(0,0,0,.3)}
    .stats{display:flex;gap:20px;font-weight:700}
    .coin{color:#facc15}
    main{display:flex;gap:20px;padding:20px;max-width:1200px;margin:auto}
    section,aside{background:#1b2345;border:1px solid #2a3560;border-radius:12px;padding:20px;flex:1}
    h2{margin-top:0;color:#7dd3fc}
    .btn{background:#1e2b60;color:white;border:none;border-radius:8px;padding:10px 14px;cursor:pointer;font-weight:700}
    .btn:hover{background:#293a80}
    input{padding:10px;border-radius:8px;border:1px solid #32406b;background:#0e1530;color:white;width:100%;font-size:18px}
    .store-item{display:flex;justify-content:space-between;align-items:center;margin:8px 0;padding:10px;border:1px dashed #405080;border-radius:10px}
    .price{color:#facc15;font-weight:700}
    .owned{color:#22c55e;font-weight:700}
    select{padding:6px 10px;border-radius:8px;background:#0e1530;color:white;border:1px solid #32406b}
  </style>
</head>
<body>
  <header>
    <div class="stats">
      <div>ğŸª™ é‡‘å¹£ï¼š<span id="coins">0</span></div>
      <div>ğŸ”¥ é€£çºŒï¼š<span id="streak">0</span></div>
    </div>
    <div>
      <label for="weekSel">é€±æ¬¡ï¼š</label>
      <select id="weekSel"></select>
      <button id="nextQ" class="btn">ä¸‹ä¸€é¡Œ</button>
      <button id="listen" class="btn">å†è½ä¸€æ¬¡ ğŸ”Š</button>
    </div>
  </header>
  <main>
    <section>
      <h2>ğŸ§ è½å¯«ç·´ç¿’</h2>
      <input id="answer" placeholder="è¼¸å…¥æ‹¼å­—..." />
      <div style="margin-top:10px;display:flex;gap:10px">
        <button id="submit" class="btn">é€å‡º</button>
      </div>
      <div id="feedback" style="margin-top:10px"></div>
      <div id="explain" style="color:#a0a8d8"></div>
      <h3>ğŸ™ï¸ éŒ„éŸ³æç¤º</h3>
      <button id="record" class="btn">éŒ„éŸ³</button>
      <button id="playRec" class="btn">æ’­æ”¾éŒ„éŸ³</button>
      <audio id="audioPlayer" controls hidden></audio>
    </section>

    <aside>
      <h2>ğŸ›’ å•†åº—</h2>
      <div class="store-item"><span>ç…™ç«ç‰¹æ•ˆ</span><span class="price">30ğŸª™</span><button class="btn buy" data-item="fireworks">è³¼è²·</button></div>
      <div class="store-item"><span>èªéŸ³åŒ…</span><span class="price">20ğŸª™</span><button class="btn buy" data-item="voicepack">è³¼è²·</button></div>
      <div class="store-item"><span>é…·ç‚«è¼¸å…¥æ¡†</span><span class="price">15ğŸª™</span><button class="btn buy" data-item="coolinput">è³¼è²·</button></div>
      <div class="store-item"><span>âœ¨ ä¸»é¡Œé¡è‰²åŒ…</span><span class="price">25ğŸª™</span><button class="btn buy" data-item="theme">è³¼è²·</button></div>
      <div class="store-item"><span>ğŸµ ç­”å°éŸ³æ•ˆåŒ…</span><span class="price">20ğŸª™</span><button class="btn buy" data-item="sound">è³¼è²·</button></div>
      <div class="store-item"><span>ğŸ“œ é¡¯ç¤ºä¾‹å¥åŠŸèƒ½</span><span class="price">10ğŸª™</span><button class="btn buy" data-item="sentence">è³¼è²·</button></div>
      <div class="store-item"><span>ğŸ§­ éš¨æ©Ÿæ¨¡å¼åˆ‡æ›</span><span class="price">10ğŸª™</span><button class="btn buy" data-item="random">è³¼è²·</button></div>
    </aside>
  </main>

  <script>
    // IndexedDB for recordings
    let db;
    const request = indexedDB.open('PierceRecordings', 1);
    request.onupgradeneeded = e => {
      db = e.target.result;
      db.createObjectStore('recordings');
    };
    request.onsuccess = e => { db = e.target.result; };

    const audioPlayer = document.getElementById('audioPlayer');
    const recordBtn = document.getElementById('record');
    const playBtn = document.getElementById('playRec');
    let recorder, audioChunks = [], isRecording = false, currentWord = '';

    recordBtn.onclick = async () => {
      if (!isRecording) {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        recorder = new MediaRecorder(stream);
        audioChunks = [];
        recorder.ondataavailable = e => audioChunks.push(e.data);
        recorder.onstop = async () => {
          const blob = new Blob(audioChunks, { type: 'audio/webm' });
          const tx = db.transaction('recordings', 'readwrite');
          tx.objectStore('recordings').put(blob, currentWord);
          alert('âœ… å·²å„²å­˜éŒ„éŸ³');
          const url = URL.createObjectURL(blob);
          audioPlayer.src = url;
          audioPlayer.hidden = false;
          audioPlayer.play();
          audioPlayer.onended = () => alert('âœ”ï¸ æ’­æ”¾çµæŸ');
        };
        recorder.start();
        recordBtn.textContent = 'åœæ­¢éŒ„éŸ³';
        isRecording = true;
      } else {
        recorder.stop();
        recordBtn.textContent = 'éŒ„éŸ³';
        isRecording = false;
      }
    };

    playBtn.onclick = () => {
      if (!currentWord) { alert('è«‹å…ˆå‡ºé¡Œå†éŒ„éŸ³'); return; }
      const tx = db.transaction('recordings', 'readonly');
      const req = tx.objectStore('recordings').get(currentWord);
      req.onsuccess = e => {
        const blob = e.target.result;
        if (blob) {
          const url = URL.createObjectURL(blob);
          audioPlayer.src = url;
          audioPlayer.hidden = false;
          audioPlayer.play();
          audioPlayer.onended = () => alert('âœ”ï¸ æ’­æ”¾çµæŸ');
        } else {
          alert('å°šæœªéŒ„éŸ³');
        }
      };
    };
  </script>
</body>
</html>